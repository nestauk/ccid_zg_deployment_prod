(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[310],{61310:function(e,t,r){"use strict";r.r(t),r.d(t,{PRESENTATION_HEIGHT:function(){return S},default:function(){return R}});var n=r(57437),l=r(22960),i=r(31193),s=r(2265),o=r(59589);r(91683),r(71601);var a=r(75511),c=r(94547),u=r(37471);function d(e){let t=e.role===c._b.Controller,r=(0,s.useContext)(u.Z),[l,i]=(0,s.useState)();(0,s.useEffect)(()=>(a.Z.on(a.z.Request_SlideRefresh,i),a.Z.on(a.z.WSS_Distribute_Message,i),()=>{a.Z.off(a.z.Request_SlideRefresh,i),a.Z.off(a.z.WSS_Distribute_Message,i)}),[]),(0,s.useEffect)(()=>{if(void 0!==l)switch(l.type){case a.z.Request_SlideRefresh:o();break;case a.z.WSS_Distribute_Message:v(l.data)}},[l]);let o=(0,s.useCallback)(()=>{setTimeout(()=>{var t,r;null===(t=e.revealRef.current)||void 0===t||t.syncSlide(e.revealRef.current.getCurrentSlide()),null===(r=e.revealRef.current)||void 0===r||r.layout()},100)},[]);(0,s.useEffect)(()=>{if(null!==e.revealRef.current){if(t)return console.debug("subscribing to reveal state..."),e.revealRef.current.on("slidechanged",g),e.revealRef.current.on("slidetransitionend",o),h().then(()=>console.debug("initial reveal state sent")),()=>{var t,r;console.debug("unsubscribing from reveal state..."),null===(t=e.revealRef.current)||void 0===t||t.off("slidechanged",g),null===(r=e.revealRef.current)||void 0===r||r.off("slidetransitionend",o)};r.state===c.um.Joined&&d()}},[t,e.revealRef.current,r.state]);let d=async()=>{let t={action:"send",type:"request-reveal-state",sessionId:e.sid};r.sendMessage(t)},g=async e=>{await h()},v=(0,s.useCallback)(async r=>{"send"!==r.action||"reveal-state-change"!==r.type||t||e.revealRef.current.setState(r.data.state),t&&"send"===r.action&&"request-reveal-state"===r.type&&await h()},[t,e.revealRef.current]),h=async()=>{let t={action:"send",type:"reveal-state-change",sessionId:e.sid,data:{state:e.revealRef.current.getState()}};await r.sendMessage(t)};return(0,n.jsx)(n.Fragment,{})}var g=r(15785),v=r(34990),h=r(97293),f=r(27692),b=r.n(f),p=r(75683),m=r.n(p);let w=e=>m().createHash("sha1").update(e).digest("base64");function A(e){let{sid:t,slides:r,regenerateThumbnails:a,sourcePresentationXml:c,selectedIndex:u,onSlideSelection:d}=e,g=(0,l.Z)(),f=(0,s.useRef)(null),p=(0,s.useRef)(null),m=(0,s.useRef)(null),A=(0,s.useRef)(null),x=(0,s.useRef)(null),S=(0,s.useRef)(0),R=(0,s.useRef)(!1),y=(0,s.useRef)([]),C=(0,s.useRef)(),I=(0,s.useRef)(null),[j,Z]=(0,s.useState)(!1);(0,s.useEffect)(()=>{if(!0!==R.current&&null!==m.current){if(R.current=!0,j||C.current||!window.indexedDB)W();else{let e=window.indexedDB.open("deliberation-thumbnails",2);e.onupgradeneeded=e=>{e.target.result.createObjectStore("thumbnails",{keyPath:"uid"}).createIndex("uid","uid",{unique:!0})},e.onsuccess=t=>{f.current=e.result,E()}}}},[t,r,m.current]);let E=()=>{let e=f.current.transaction(["thumbnails"],"readonly").objectStore("thumbnails").get(t);e.onerror=e=>{console.warn("preload thumbnail error",e),W()},e.onsuccess=t=>{var r,n;console.debug("Retrieved thumbnails");let l=w(c);console.debug("Slides XML hash: ".concat(l)),console.debug("ObjectStore XML hash: ".concat(null===(r=e.result)||void 0===r?void 0:r.hash)),(null===(n=e.result)||void 0===n?void 0:n.hash)===l&&(C.current=e.result),W()}},W=()=>{var e;(C.current=null!==(e=C.current)&&void 0!==e?e:{uid:t,hash:w(c),previews:[]},C.current.previews.length>0&&!a)?(console.debug("Restored ".concat(C.current.previews.length," previews from local storage")),Z(!0)):(console.debug("No previews in local storage - generating new previews."),console.log("revealDivRef",m.current),p.current=new o.Z(m.current,{embedded:!0,controls:!1,keyboard:!1,touch:!1,overview:!1,help:!1,hideInactiveCursor:!1,showNotes:!1,plugins:[],transitionSpeed:"fast"}),p.current.initialize({progress:!1,autoPlayMedia:!1,scrollActivationWidth:void 0}).then(()=>{console.debug("Reveal ready"),p.current.slide(0),p.current.on("slidetransitionend",N),S.current=p.current.getHorizontalSlides().length,y.current=[...Array(S.current).fill(0).map((e,t)=>t)],k()}))},k=()=>{if(!(y.current.length>0))return!1;{let e=y.current.shift();return console.debug("initialising thumbnail for slide ".concat(e,"...")),setTimeout(()=>{D(e)},100),!0}},D=e=>{console.debug("Triggering generation ".concat(e,"...")),p.current.getIndices().h!==e?(console.debug("Sending slide from ".concat(p.current.getIndices().h," to ").concat(e,"...")),p.current.slide(e)):(console.debug("Slide already in position ".concat(e,".")),setTimeout(()=>{P()},1e3))},N=e=>{console.debug("onSlideTransitionEnd at: ".concat(p.current.getIndices().h)),setTimeout(()=>{P()},1e3)},P=()=>{let e=p.current.getIndices().h;console.debug("Capturing thumbnail for slide at index: ".concat(e));let t=p.current.getCurrentSlide();t.style.top="0px",(0,h.YM)(t,{cacheBust:!1,imagePlaceholder:"data:image/gif;base64,R0lGODlhGQAZAPQAAISChKWipcbT7+fr/8bf51KuOdbf93vDc87b9/f3997n/2u2Y9bf/5SSlJzHtcbT9////+/z/1KyOdbj94zHjNbb9/f3/2u6Y9bj/5yenLXP1sbX9wAAAAAAAAAAAAAAACH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+ICAgPD94cGFja2V0IGVuZD0idyI/PgH//v38+/r5+Pf29fTz8vHw7+7t7Ovq6ejn5uXk4+Lh4N/e3dzb2tnY19bV1NPS0dDPzs3My8rJyMfGxcTDwsHAv769vLu6ubi3trW0s7KxsK+urayrqqmop6alpKOioaCfnp2cm5qZmJeWlZSTkpGQj46NjIuKiYiHhoWEg4KBgH9+fXx7enl4d3Z1dHNycXBvbm1sa2ppaGdmZWRjYmFgX15dXFtaWVhXVlVUU1JRUE9OTUxLSklIR0ZFRENCQUA/Pj08Ozo5ODc2NTQzMjEwLy4tLCsqKSgnJiUkIyIhIB8eHRwbGhkYFxYVFBMSERAPDg0MCwoJCAcGBQQDAgEAACwAAAAAGQAZAAAF/2DgWGRpmlkTaIkFvWIkzzSdZY42JS8UBIqJcEicKBSZAGSSIfB8AaHBMBlYB5OpMAlJaAhOyy+LKLsgljKCyn1pMruxATGI9CARxZqZ0fgDKg5yCHZ3EAN7KQ2LjA1JVWeGiGVCV1aAjwOGPZN0dTNijlFzaqWlWlQKA5hRCBuvsLGnWgqsEwgCsLmxurAIE7a4rwLEucW7u78EGmO4x8/QAr8uj87PfhrRCmfV0djRmi/dxA4OC+foF34CE4bjAuUFBRL05zkICj0JCd0a5vQAAx4wZEuAPwoLAgYs18NCBFsEHBxQqPDJCyyAfiw7kJCiBAcE9H0BpiJARI8AQyL2IKCOZIAMFCZ6dLDvRYKYEig4SPHywAWUGu4kAHiAwqIQADs="}).then(t=>{C.current.previews[e]={pngDataUrl:t},k()||G()}).catch(t=>{console.error("error capturing element",t),C.current.previews[e]={pngDataUrl:"/icons/broken-image-placeholder.png"},k()||G()})},G=()=>{console.debug("Completed preview generation"),console.debug("Storing thumbnails...");let e=f.current.transaction(["thumbnails"],"readwrite").objectStore("thumbnails").put(C.current);e.onerror=e=>{var t;console.warn("Error storing thumbnails",e),null===(t=p.current)||void 0===t||t.destroy(),p.current=null,Z(!0),R.current=!1},e.onsuccess=e=>{var t;console.debug("Stored thumbnails",e),null===(t=p.current)||void 0===t||t.destroy(),p.current=null,Z(!0),R.current=!1}};return(0,s.useEffect)(()=>{if(j&&I){var e;null===(e=I.current)||void 0===e||e.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.Z,{sx:{display:"block",overflowX:"scroll"},children:(0,n.jsx)(i.Z,{sx:{display:"flex",flexDirection:"row",gap:1,textWrap:"nowrap",whiteSpace:"nowrap",flexWrap:"nowrap"},children:j&&C.current.previews.map((e,t)=>(0,n.jsx)(i.Z,{sx:{padding:1,border:u===t?"solid 2px":"solid 1px",borderColor:u===t?g.palette.primary.main:g.palette.divider,borderRadius:1,width:"auto",height:"auto",display:"inline-block"},onClick:()=>d(t),children:(0,n.jsx)("img",{ref:u===t?I:void 0,src:e.pngDataUrl,width:150,height:"auto"},"presentation-preview-image-".concat(t))},"presentation-preview-".concat(t)))})}),(0,n.jsx)(i.Z,{sx:{maxWidth:"100%",overflowX:"scroll",display:"flex",flexDirection:"row",flexWrap:"nowrap",gap:1,m:0,p:0,alignItems:"stretch"},children:!j&&(0,n.jsx)(i.Z,{ref:x,sx:{flexGrow:1,display:"block"},children:(0,n.jsx)("div",{style:{textAlign:"center",marginTop:50},children:(0,n.jsx)(v.Z,{elevation:1,sx:{display:"inline-block",p:2},children:(0,n.jsxs)(i.Z,{flexDirection:"row",display:"flex",alignItems:"center",alignSelf:"middle",children:[(0,n.jsx)("div",{style:{width:26,height:26,marginRight:5,border:"solid 3px",borderColor:g.palette.primary.main},children:(0,n.jsx)("div",{className:"reveal",ref:m,children:(0,n.jsx)("div",{className:"slides ".concat(b().slideWrapControl),ref:A,children:r})})}),"Generating previews..."]})})})})})]})}var x=r(30089);let S=400;function R(e){let t=(0,l.Z)(),r=e.role===c._b.Controller,a=e.role===c._b.Controller,u=e.role===c._b.Controller;console.debug("Presentation rerender...");let v=(0,s.useRef)(null),h=(0,s.useRef)(null),[f,b]=(0,s.useState)(0),[p,m]=(0,s.useState)(g.I);(0,s.useEffect)(()=>{if(!v.current&&h.current){var t,n;console.debug("⬆️ Presentation mount...");let l=u&&(null===(t=window)||void 0===t?void 0:t.localStorage.getItem("RevealState-".concat(e.sid)))?JSON.parse(null===(n=window)||void 0===n?void 0:n.localStorage.getItem("RevealState-".concat(e.sid))):null;v.current=new o.Z(h.current,{embedded:e.embedded,controls:r,keyboard:r,touch:r,overview:!1,help:r,hideInactiveCursor:!r,showNotes:!1,plugins:[]}),console.debug("initialising reveal..."),v.current.initialize({controlsTutorial:!1,slideNumber:r?"c/t":void 0,progress:!1,controlsBackArrows:"faded",controlsLayout:"edges",scrollActivationWidth:void 0}).then(()=>{var t,r;console.debug("Reveal: initialised"),l&&(console.debug("Applying reveal state",l),v.current.setState(l)),v.current.on("slidechanged",t=>{console.debug("Reveal: slidechanged",t);let r=v.current.getState();u&&window.localStorage.setItem("RevealState-".concat(e.sid),JSON.stringify(r)),console.debug("stored state",r),b(r.indexh)}),b(null!==(r=null===(t=v.current)||void 0===t?void 0:t.getState().indexh)&&void 0!==r?r:0),w()}).catch(e=>console.error(e))}},[]),(0,s.useEffect)(()=>{v.current&&w()},[f,v.current]);let w=()=>{var e,t,r;console.debug("Updating slide data...");let n=!!(null===(e=v.current)||void 0===e?void 0:e.getCurrentSlide());m(S(f,null===(t=v.current)||void 0===t?void 0:t.getCurrentSlide(),n?null===(r=v.current)||void 0===r?void 0:r.getSlideNotes():null))},S=(e,t,r)=>{if(!t)return g.I;let n=(0,x.kh)(t.getAttribute("qids")),l=t.getAttribute("secs"),i=null!==l?parseFloat(l):void 0,s=t.getAttribute("activity"),o=null!==s?(0,x.pC)(s):g.S.default,a=t.getAttribute("recording");return console.table({index:e,qids:n,activity:g.S[o],time_s:i}),{index:e,notes:null!=r?r:"",qids:null!=n?n:[],secs:i,activity:o,recordingId:null!=a?a:void 0}};return(0,s.useEffect)(()=>()=>{v.current&&v.current.isReady()&&(console.debug("⬇️ Presentation unmount..."),v.current.destroy(),v.current=null)},[]),(0,s.useEffect)(()=>{e.onSlideDataChange&&e.onSlideDataChange(p)},[p]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(i.Z,{sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[(0,n.jsx)(i.Z,{sx:{flexGrow:1,display:"block",m:0,p:0},children:(0,n.jsx)("div",{className:"reveal",ref:h,style:{borderRadius:5,border:e.showBorder?"solid 3px":void 0,borderColor:e.showBorder?t.palette.primary.main:void 0},children:(0,n.jsx)("div",{className:"slides",children:e.slides})})}),a&&(0,n.jsx)(A,{slides:e.slides,sourcePresentationXml:e.sourcePresentationXml,selectedIndex:f,sid:e.sid,regenerateThumbnails:e.regenerateThumbnails,onSlideSelection:e=>{console.debug("Thumbnail selected: ".concat(e)),v.current?(v.current.slide(e),b(e)):console.warn("localReveal not yet loaded - unable to switch slides from thumbnail")}})]}),(0,n.jsx)(d,{role:e.role,revealRef:v,sid:e.sid})]})}},27692:function(e){e.exports={slideWrapControl:"previews_slideWrapControl__IsWaW"}}}]);
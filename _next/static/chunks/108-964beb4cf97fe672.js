(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[108],{79418:function(e,t,n){"use strict";function i(e){if(null!=e)return parseInt(e)}function r(e){return!0===e||!1===e?e:"true"===e||"false"===e?"true"===e:"t"===e||"f"===e?"t"===e:(1===e||0===e)&&1===e}n.d(t,{LC:function(){return i},gx:function(){return r},zW:function(){return function e(t){if(t instanceof Array)return t.map(function(t){return"object"==typeof t&&(t=e(t)),t});{let n={};for(let i in t)if(t.hasOwnProperty(i)){let r=(i.charAt(0).toLowerCase()+i.slice(1)||i).toString(),s=t[i];(s instanceof Array||null!==s&&s.constructor===Object)&&(s=e(s)),n[r]=s}return n}}}})},30089:function(e,t,n){"use strict";n.d(t,{Cc:function(){return h},H7:function(){return v},av:function(){return x},f_:function(){return f},if:function(){return u},kh:function(){return p},ot:function(){return m},pC:function(){return b},tL:function(){return g},te:function(){return d},yg:function(){return y}});var i=n(6121),r=n(71359),s=n(45080),o=n(15785),a=n(20920),l=n(24132),c=n(2962);let d=(e,t)=>{if(void 0!==e){let i=(0,a.Z)();if(void 0!==e.key&&null!==e.key){var n;return{...e,key:"".concat(t,"-").concat(null!==(n=e.key)&&void 0!==n?n:"undefined","+").concat(i)}}}},u=e=>e?Object.fromEntries(e.split(";").map(e=>e.trim().split(":").map(e=>e.trim()))):{},h=e=>e?Object.fromEntries(e.split(";").map(e=>e.trim().split(":").map(e=>e.trim()))):{},p=e=>{if(null!=e&&0!==e.length)return(0,i.Q)(e,{columns:!1,skip_empty_lines:!0,trim:!0})[0]},g=e=>null==e?void 0:e.map((e,t)=>""===e?" ".repeat(t):e),f=e=>{let t=parseFloat(null!=e?e:"");return isNaN(t)?void 0:t},x=e=>{let t=null==e?void 0:e.toLowerCase(),n=r.Q[t];if(void 0===n)throw console.error("Unknown slider input type: ".concat(e)),"Unknown slider input type: ".concat(e);return n},m=e=>{let t=null==e?void 0:e.toLowerCase(),n=l.rT[t];if(void 0===n)throw console.error("Unknown graph input type: ".concat(e)),"Unknown graph input type: ".concat(e);return n},y=e=>{let t=null==e?void 0:e.toLowerCase(),n=c.J[t];if(void 0===n)throw console.error("Unknown graph orientation: ".concat(e)),"Unknown graph orientation: ".concat(e);return n},v=e=>{let t=null==e?void 0:e.toLowerCase(),n=s.L[t];if(void 0===n)throw console.error("Unknown text input type: ".concat(e)),"Unknown text input type: ".concat(e);return n},b=e=>{let t=null==e?void 0:e.toLowerCase(),n=o.S[t];if(void 0===n)throw console.error("Unknown slide activity: ".concat(e)),"Unknown slide activity: ".concat(e);return n}},37471:function(e,t,n){"use strict";n.d(t,{C:function(){return f},Z:function(){return p}});var i=n(57437),r=n(2265),s=n(5085),o=n(94547),a=n(75511),l=n(70972),c=n(79044);let d=n(25566).env.NEXT_PUBLIC_WSS_ENDPOINT,u={debug:!1,connectionTimeout:3e3,maxReconnectionDelay:1e4,minReconnectionDelay:100,reconnectionDelayGrowFactor:1.3,maxRetries:1/0},h=(e,t,n)=>({deviceId:e.deviceId,sessionId:n,sessionToken:e.sessionToken,role:e.role,deviceName:void 0,participantName:t.participantName}),p=(0,r.createContext)({}),g=[o.um.Online,o.um.Connecting,o.um.Connected,o.um.Joining];function f(e){var t;let n=null!==(t=e.endpoint)&&void 0!==t?t:d;if(!n)throw"No endpoint found for Zeitgeist WSS";let f=(0,r.useContext)(s.rZ),x=(0,r.useContext)(c.K),m=(0,r.useRef)(null),[y,v]=(0,r.useState)(o.um.Offline),[b,w]=(0,r.useState)(!1),[j,k]=(0,r.useState)(!1),[S,Z]=(0,r.useState)(),C=(0,r.useCallback)(e=>{try{return m.current.send(JSON.stringify(e)),!0}catch(e){return console.error(e),!1}},[m]),[D,I]=(0,r.useState)({state:y,isError:j,joinedOnce:b,sendMessage:C});(0,r.useEffect)(()=>{if(void 0===window||void 0===window.navigator)throw"Window undefined.";window.addEventListener("online",()=>{y===o.um.Offline&&v(o.um.Online)}),window.addEventListener("offline",()=>{v(o.um.Offline)}),v(window.navigator.onLine?o.um.Online:o.um.Offline)},[]),(0,r.useEffect)(()=>{Z(h(f,x,e.sid))},[f.deviceId,e.sid,f.sessionToken,f.role,x.participantName]),(0,r.useEffect)(()=>{I({state:y,isError:j,joinedOnce:b,sendMessage:C})},[m,y,j,b,C]),(0,r.useEffect)(()=>{switch(console.debug("WSS state change",o.um[y]),y){case o.um.Offline:try{var e;null===(e=m.current)||void 0===e||e.close()}catch(e){console.warn(e)}break;case o.um.Online:A(),v(o.um.Connecting);break;case o.um.Connecting:E();break;case o.um.Connected:v(o.um.Joining);break;case o.um.Joining:P();break;case o.um.Joined:w(!0);break;case o.um.Error:E()}k(y===o.um.Error)},[y]);let E=()=>{setTimeout(()=>{[l.Z.CLOSING,l.Z.CLOSED].includes(m.current.readyState)&&(console.debug("Recreating socket..."),A())},1e3)},A=()=>{if(null!==m.current){try{m.current.close()}catch(e){console.warn(e)}m.current.onopen=null,m.current.onclose=null,m.current.onerror=null,m.current.onmessage=null,m.current=null}m.current=q()},q=()=>{let e=new l.Z(n,[],u);return e.onopen=e=>{console.debug("WSS open",e),v(o.um.Connected)},e.onclose=e=>{console.warn("WSS close",e),v(o.um.Disconnected)},e.onerror=e=>{console.error("WSS error",e),v(o.um.Error)},e.onmessage=async e=>{await _(e)},e},P=()=>{var e,t;console.debug("Joining session...");let n={action:"join",deviceId:S.deviceId,sessionId:S.sessionId,sessionToken:S.sessionToken,deviceName:null!==(e=S.deviceName)&&void 0!==e?e:null,participantName:null!==(t=S.participantName)&&void 0!==t?t:null,role:S.role};m.current.send(JSON.stringify(n))},_=e=>{if(null==e?void 0:e.data){let t=JSON.parse(e.data);t&&("send"===t.action&&"remote-log"===t.type&&T(t),"send"===t.action&&"join-confirmation"===t.type&&R(t),a.Z.emit({type:a.z.WSS_Distribute_Message,data:t}))}},T=e=>{switch(e.data.severity){case"debug":console.debug("Remote debug log",e.data.message);break;case"info":console.info("Remote info log",e.data.message);break;case"warn":console.warn("Remote warn log",e.data.message);break;case"error":console.error("Remote error log",e.data.message);break;default:console.log("Remote log",e.data.message)}},R=e=>{console.debug("Join confirmation"),v(o.um.Joined)};return(0,i.jsxs)(i.Fragment,{children:[j&&!b&&e.error,!j&&!b&&g.includes(y)&&e.loading,b&&(0,i.jsx)(p.Provider,{value:D,children:e.children})]})}},67506:function(e,t,n){"use strict";n.d(t,{G:function(){return d},Z:function(){return u}});var i,r,s=n(57437),o=n(2265),a=n(80237),l=n(75511),c=n(58253);let d=(0,o.createContext)({});function u(e){var t;let n=(0,o.useContext)(c.A),[i,u]=(0,o.useState)(0),[h,p]=(0,o.useState)(),[g,f]=(0,o.useState)(null!==(t=e.checks)&&void 0!==t?t:3);(0,o.useEffect)(()=>{switch(console.debug("ZgServerTimeProvider state",r[i]),i){case 0:l.Z.emit({type:l.z.Content_Progress_Update,data:{overall:{completed:0,total:g},bars:{}}}),u(1);break;case 1:x().then(e=>{p(e),u(3)}).catch(e=>{console.error(e),u(2)})}},[i]);let x=async()=>{switch(e.mode){case"server-date-lib":return y();case"zg-server-time":return m();default:throw Error("Unsupported time sync mode")}},m=async()=>{let e;console.debug("zg-server-time warmup",await n.getServerTime());let t=Number.MAX_SAFE_INTEGER,i=0;for(let r=0;r<g;r++){let s=Date.now(),o=await n.getServerTime(),a=Date.now();console.debug("zg-server-time response",o);let c=a-s,d=(s+a)/2,u=o.timestamp-d;c<t&&(t=c,i=u,e=o),l.Z.emit({type:l.z.Content_Progress_Update,data:{overall:{completed:r+1,total:g},bars:{}}}),await new Promise(e=>setTimeout(e,1e3))}let r={offset:i,rtt:t,source:e,toServerTime:e=>e+i,fromServerTime:e=>e-i};return console.debug("zg-server-time result",r),r},y=async()=>{let e;console.warn("ServerDateLib is only accurate to the second.");for(let t=0;t<g;t++){await new Promise(e=>setTimeout(e,1e3));let n=await (0,a.a)();(void 0===e||Math.abs(n.uncertainty)<Math.abs(e.uncertainty))&&(e=n),l.Z.emit({type:l.z.Content_Progress_Update,data:{overall:{completed:t+1,total:g},bars:{}}})}let t={offset:e.offset,source:e,rtt:e.uncertainty,toServerTime:t=>t+e.offset,fromServerTime:t=>t-e.offset};return console.debug("server-date result",e),t};return(0,s.jsxs)(s.Fragment,{children:[(0===i||1===i)&&e.loading,2===i&&e.error,3===i&&(0,s.jsx)(d.Provider,{value:h,children:e.children})]})}(i=r||(r={}))[i.Init=0]="Init",i[i.Synchronising=1]="Synchronising",i[i.Error=2]="Error",i[i.Complete=3]="Complete"},74382:function(e,t,n){"use strict";n.d(t,{UJ:function(){return g},ZP:function(){return f},Zp:function(){return p},v1:function(){return u}});var i=n(57437),r=n(2265),s=n(58253),o=n(75511),a=n(79418),l=n(69026),c=n(5085),d=n(37570);let u=(0,r.createContext)({}),h=e=>{let t={};return e.answers.forEach(e=>{var n;t[e.questionId]=[...null!==(n=t[e.questionId])&&void 0!==n?n:[],e]}),t},p=(e,t,n)=>{var i;return null!==(i=g(e,t))&&void 0!==i?i:(0,l.N)(t,null!=n&&n)},g=(e,t)=>null==e?void 0:e.find(e=>e.questionId===t.qid&&e.participantId===t.pid);function f(e){let t=(0,r.useContext)(c.rZ),n=(0,r.useContext)(d.H),l=(0,r.useContext)(s.A),[p,g]=(0,r.useState)(h(n.session)),[f,x]=(0,r.useState)();(0,r.useEffect)(()=>(o.Z.on(o.z.WSS_Distribute_Message,x),()=>{o.Z.off(o.z.WSS_Distribute_Message,x)}),[]),(0,r.useEffect)(()=>{void 0!==f&&f.type===o.z.WSS_Distribute_Message&&m(f.data)},[f]);let m=e=>{if("send"===e.action&&"answer-summary-update"===e.type){let t=e.data.questionId,n=(0,a.zW)(e.data.answers);g({...p,[t]:n})}},y=(0,r.useCallback)(async e=>{let i=await l.getDeliberationAnswersForQuestion(n.sid,e,t.sessionToken);g({...p,[e]:i})},[g,p,n.sid,t.sessionToken]);return(0,i.jsx)(u.Provider,{value:{sid:n.sid,allAnswers:p,requestUpdate:y},children:e.children})}},70883:function(e,t,n){"use strict";n.d(t,{Z:function(){return c},l:function(){return l}});var i=n(57437),r=n(2265),s=n(75511),o=n(5085),a=n(37471);let l=(0,r.createContext)({});function c(e){let t=(0,r.useContext)(o.rZ),[n,c]=(0,r.useState)([]),[d,u]=(0,r.useState)(n.find(e=>e.deviceId===t.deviceId)),h=(0,r.useContext)(a.Z);(0,r.useEffect)(()=>{h.sendMessage({action:"request",type:"subscription-update",sessionId:e.sid})},[]);let[p,g]=(0,r.useState)();(0,r.useEffect)(()=>(s.Z.on(s.z.WSS_Distribute_Message,g),()=>{s.Z.off(s.z.WSS_Distribute_Message,g)}),[]),(0,r.useEffect)(()=>{void 0!==p&&p.type===s.z.WSS_Distribute_Message&&f(p.data)},[p]);let f=e=>{if("send"===e.action&&"subscription-update"===e.type){var t;c(null!==(t=e.data.subscriptions)&&void 0!==t?t:[])}};return(0,r.useEffect)(()=>{u(n.find(e=>e.deviceId===t.deviceId))},[n,t]),(0,i.jsx)(l.Provider,{value:{subscriptions:n,thisUser:d},children:e.children})}},60182:function(e,t,n){"use strict";n.d(t,{d:function(){return h},Z:function(){return g}});var i=n(57437),r=n(2265),s=n(94547),o=n(75511);function a(e){if(e)return new Date(e)}var l=n(79418),c=n(58253),d=n(37471),u=n(37570);let h=(0,r.createContext)({}),p=e=>({fullScreen:e.fullScreen,facilitationState:e.facilitationState,sessionStartedAt:a(e.sessionStartedAt)});function g(e){let t=(0,r.useContext)(u.H),n=(0,r.useContext)(c.A),g=(0,r.useContext)(d.Z),[f,x]=(0,r.useState)(p(t.session)),[m,y]=(0,r.useState)();(0,r.useEffect)(()=>(o.Z.on(o.z.WSS_Distribute_Message,y),()=>{o.Z.off(o.z.WSS_Distribute_Message,y)}),[]),(0,r.useEffect)(()=>{void 0!==m&&m.type===o.z.WSS_Distribute_Message&&v(m.data)},[m]);let v=e=>{if("send"===e.action&&"session-update"===e.type){let t=(0,l.zW)(e.data.session);x({fullScreen:t.fullScreen,facilitationState:t.facilitationState,sessionStartedAt:a(t.sessionStartedAt)})}};return(0,r.useEffect)(()=>{g.state===s.um.Joined&&(console.debug("Refetching session data..."),n.getDeliberationSession(t.sid,void 0).then(e=>{console.debug("New session data",e),x(p(e)),console.debug("new data",f)}).catch(e=>{throw console.error("WssConnectionState.Joined. Encountered an error fetching session data.",e),e}))},[g.state]),(0,i.jsx)(h.Provider,{value:f,children:e.children})}},4766:function(e,t,n){"use strict";n.d(t,{X:function(){return s},Z:function(){return o}});var i=n(57437),r=n(2265);let s=(0,r.createContext)({});function o(e){let[t,n]=(0,r.useState)({});return(0,i.jsx)(s.Provider,{value:{data:t,setData:n},children:e.children})}},93191:function(e,t,n){"use strict";n.d(t,{N:function(){return c},Z:function(){return d}});var i=n(57437),r=n(2265),s=n(4766),o=n(5085),a=n(57818),l=n(30617);let c=(0,r.createContext)({});function d(e){let t=(0,r.useContext)(l.F),d=(0,r.useContext)(s.X),u=(0,r.useContext)(o.rZ),h=e=>{d.setData(e)},[p,g]=(0,r.useState)(void 0);return(0,r.useEffect)(()=>{let r=(0,a.default)(()=>Promise.all([n.e(885),n.e(518),n.e(218),n.e(287),n.e(310)]).then(n.bind(n,61310)),{loadableGenerated:{webpack:()=>[61310]},ssr:!1});g((0,i.jsx)(r,{sid:t.sid,role:u.role,slides:t.slides,sourcePresentationXml:t.sourceXml.join("\n"),embedded:!0,onSlideDataChange:h,showBorder:!1,regenerateThumbnails:e.refresh}))},[]),(0,i.jsx)(i.Fragment,{children:!!p&&(0,i.jsx)(c.Provider,{value:{presentation:p},children:e.children})})}},5085:function(e,t,n){"use strict";n.d(t,{ZP:function(){return h},rZ:function(){return u}});var i,r,s=n(57437),o=n(2265),a=n(94547),l=n(20920),c=n(67022),d=n(58253);(i=r||(r={}))[i.Init=0]="Init",i[i.Authenticating=1]="Authenticating",i[i.AuthError=2]="AuthError",i[i.AuthNotRequired=3]="AuthNotRequired",i[i.Authenticated=4]="Authenticated",i[i.ExchangingJoinCode=5]="ExchangingJoinCode",i[i.JoinCodeError=6]="JoinCodeError",i[i.JoinCodeAccepted=7]="JoinCodeAccepted",i[i.Ready=8]="Ready";let u=(0,o.createContext)({});function h(e){var t;let[n,i]=(0,o.useState)((null===(t=window)||void 0===t?void 0:t.localStorage.getItem("DeviceId"))||(0,l.Z)());(0,o.useEffect)(()=>{window&&window.localStorage.setItem("DeviceId",n)},[n]);let[h,p]=(0,o.useState)(0),[g,f]=(0,o.useState)(void 0),[x,m]=(0,o.useState)(e.role),[y,v]=(0,o.useState)(),[b,w]=(0,o.useState)(!1),[j,k]=(0,o.useState)({deviceId:n,role:x,state:h,user:g,sessionToken:y});(0,o.useEffect)(()=>{k({...j,state:h})},[h]),(0,o.useEffect)(()=>{k({...j,user:g})},[g]),(0,o.useEffect)(()=>{k({...j,role:x})},[x]),(0,o.useEffect)(()=>{k({...j,sessionToken:y})},[y]);let S=(0,c.aC)(),Z=(0,o.useContext)(d.A);return(0,o.useEffect)(()=>{switch(console.debug("User state",r[h]),h){case 0:switch(x){case a._b.Controller:p(1);break;case a._b.Client:p(3),f(null);break;default:throw"Unsuported role: ".concat(a._b[x])}break;case 1:S.signinSilent().then(e=>{null!==e?(console.info("User found",e.profile.email),f(e),p(4)):(console.debug("Not authenticated"),f(void 0),p(2))}).catch(e=>{console.error(e),f(void 0),p(2)});break;case 2:case 6:break;case 4:case 3:p(5);break;case 5:let t={deviceId:n,role:x,joinCode:e.joinCode,sessionId:e.sid};Z.exchangeJoinCodeForSessionToken(t).then(e=>{v(e.sessionToken),p(7)}).catch(e=>{console.error(e),p(6)});break;case 7:p(8)}w(!![2,6].find(e=>e===h))},[h]),(0,s.jsxs)(s.Fragment,{children:[b&&e.error,8!==h&&!b&&e.loading,8===h&&!b&&(0,s.jsx)(u.Provider,{value:j,children:e.children})]})}},30617:function(e,t,n){"use strict";n.d(t,{F:function(){return tC},Z:function(){return tD}});var i,r,s,o,a,l,c,d,u,h,p,g,f=n(57437),x=n(2265),m=n(58253),y=n(5085),v=n(37570),b=n(22599),w=n.n(b);class j{async init(){if(this.initialised)return;this.storageAvailable=void 0!==window&&void 0!==window.navigator&&void 0!==window.navigator.storage,this.persistAvailable=this.storageAvailable&&void 0!==window.navigator.storage.persist,this.mayPersist=this.storageAvailable&&void 0!==window.navigator.storage.persist&&await window.navigator.storage.persist(),this.retrieveAvailable=this.storageAvailable&&void 0!==window.navigator.storage.getDirectory,this.estimateAvailable=this.storageAvailable&&void 0!==window.navigator.storage.estimate;let e=[["Workshop dir",this.workshopDir],["Storage Available",this.storageAvailable],["Persist Available",this.persistAvailable],["Retrieve available",this.retrieveAvailable],["Estimate available",this.estimateAvailable],["May Persist",this.mayPersist]];if(this.estimateAvailable){let t=await navigator.storage.estimate();e.push(["Quota",t.quota]),e.push(["Usage",t.usage])}else e.push(["Quota","N/K"]),e.push(["Usage","N/K"]);console.table(e),this.initialised=!0}async getAsUrl(e,t){if(!this.initialised)throw"Not initialised";if(e.startsWith("blob:"))return console.debug("getAsUrl","blob: url requested - passing back the same url."),e;let n=await this.getAsEntry(e,t);try{return URL.createObjectURL(n.content)}catch(t){return console.warn("getAsUrl","Unable to create blob URL for: ".concat(e),t),n.sourceUrl}}async getAsEntry(e,t){if(!this.initialised)throw"Not initialised";if(e.startsWith("blob:")){let n=e.substring(5);return await this.getAsEntry(n,t)}let n=this.forceFetch?null:await this.getCacheData(e);if(this.forceFetch&&console.debug("getAsEntry","cache skip for: ".concat(e)),null!==n&&(void 0===n.content||0===n.content.size)&&(n=null),console.debug("getAsEntry","Cache ".concat(null===n?"miss for":"hit for",": ").concat(e)),null===n){try{n=await this.fetchContent({key:e},t)}catch(t){throw console.error("getAsEntry","Unable to fetch data for: ".concat(e),t),t}try{void 0!==n.content&&n.content.size>0?(console.debug("getAsEntry","Cacheing ".concat(n.content.size," bytes of data for: ").concat(e),n),await this.storeCacheData(n)):(void 0===n.content&&console.warn("getAsEntry","Content for ".concat(e," is undefined.")),void 0!==n.content&&0===n.content.size&&console.warn("getAsEntry","Content for ".concat(e," has 0 bytes.")))}catch(t){console.warn("getAsEntry","Unable to cache the data for: ".concat(e),t)}}return n}async storeCacheData(e){if(this.persistAvailable){var t;let n=e.key.split("/").slice(-1)[0],i=new Date;e.created=null!==(t=e.created)&&void 0!==t?t:i,e.updated=i;let r=await window.navigator.storage.getDirectory(),s=await r.getDirectoryHandle("workshops",{create:!0}),o=await s.getDirectoryHandle(this.workshopDir,{create:!0}),a=await o.getDirectoryHandle("content",{create:!0}),l=await a.getFileHandle(n,{create:!0}),c=await l.createWritable();try{await c.write(e.content)}catch(e){throw console.warn("storeCacheData","error writing to cache",e),e}finally{await c.close(),console.debug("storeCacheData","content stored",e.key)}}}async getCacheData(e){if(!this.retrieveAvailable)return null;try{let t=e.split("/").slice(-1)[0],n=await window.navigator.storage.getDirectory(),i=await n.getDirectoryHandle("workshops",{create:!0}),r=await i.getDirectoryHandle(this.workshopDir,{create:!0}),s=await r.getDirectoryHandle("content",{create:!0}),o=await s.getFileHandle(t),a=await o.getFile();return{key:e,content:a}}catch(e){return console.warn("getCacheData - error encountered, this is a cache miss",e),null}}async fetchContent(e,t){return(await this.fetchContents([e],t))[0]}async fetchContents(e,t){let n=await this.getAccessUrls(e.map(e=>this.fixKeyForS3(e.key))),i=e.map(e=>({key:e.key,url:n.objectKeysToAccessUrls[this.fixKeyForS3(e.key)]}));console.debug("fetchContents","Fetched keysToUrls",i);let r=i.map(e=>this.download(e,t));console.debug("fetchContents","Fetching ".concat(r.length," content items..."));let s=await Promise.all(r);return console.debug("fetchContents","fetch contents complete",s),s}async download(e,t){let n=0;do{try{var i;let n=await fetch(e.url);if(null===n.body)throw"No content found in response for: ".concat(e.key,", at: ").concat(e.url);let r=n.headers.get("Content-Length");if(null===r)throw"Content-Length not found in response for: ".concat(e.key,", at: ").concat(e.url);let s=null!==(i=n.headers.get("Content-Type"))&&void 0!==i?i:void 0;if(void 0===s)throw"Content-Type not found in response for: ".concat(e.key,", at: ").concat(e.url);console.debug("download","".concat(e.key," content-type: ").concat(s));let o=n.body.getReader(),a=Number.parseInt(r);void 0!==t&&t(e.key,0,a);let l=[],c=0;for(;;){let{done:n,value:i}=await o.read();if(n)break;l.push(i),c+=i.length,void 0!==t&&t(e.key,c,a)}let d=new Uint8Array(c),u=0;for(let e of l)d.set(e,u),u+=e.length;return{content:new Blob(l,{type:s}),sourceUrl:e.url,key:e.key}}catch(t){console.warn("download","Error fetching: ".concat(e.key,", attempt: ").concat(n),t),await new Promise(e=>setTimeout(e,1e3))}n++}while(n<3);throw"Failed to fetch: ".concat(e.key)}async getAccessUrls(e){let t={objectKeys:e.filter(e=>this.isKeyForS3(e))},n=e.filter(e=>!this.isKeyForS3(e));console.debug("getAccessUrls","requests to s3 for:",t);let i=await this.api.getSessionContentAccessUrls(this.session.id,this.sessionToken,t);return n.forEach(e=>i.objectKeysToAccessUrls[e]=e),i}fixKeyForS3(e){if(this.isKeyForS3(e)){e=w().trim(e,"/");let t="workshops/".concat(this.workshopDir,"/");e.startsWith(t)||(e="".concat(t).concat(e))}return e}isKeyForS3(e){return!e.startsWith("https://")&&!e.startsWith("http://")}constructor(e,t,n,i,r){this.api=e,this.session=t,this.sessionToken=n;let s=i.split("/").slice(-2)[0];this.workshopDir=s,this.forceFetch=r,this.initialised=!1,this.storageAvailable=!1,this.persistAvailable=!1,this.mayPersist=!1,this.retrieveAvailable=!1,this.estimateAvailable=!1}}let k=["src","graphic","videoUri","posterUri","sideBackgroundImage","mainBackgroundImage","data-background-image"],S=["style","sideStyle","mainStyle"];class Z{getAsSectionTags(e,t){let n=new DOMParser().parseFromString(e,"text/xml").getElementsByTagName("section"),i=[];console.debug("Module ".concat(t," contains ").concat(n.length," sections."));for(let e=0;e<n.length;e++){let r=n.item(e);r&&r.setAttribute("key","module-".concat(t,"-section-").concat(e));let s=new XMLSerializer().serializeToString(r);i.push(s)}return w().join(i,"\n")}reset(){this.progressData={overall:{completed:0,total:0},bars:{}},this.sendUpdate()}updateProgress(e,t,n){this.progressData.bars[e]={completed:t,total:n},this.progressData.overall.completed=w().sum(Object.entries(this.progressData.bars).map(e=>e[1].completed)),this.progressData.overall.total=w().sum(Object.entries(this.progressData.bars).map(e=>e[1].total)),this.sendUpdate()}sendUpdate(){var e;null===(e=this.onUpdate)||void 0===e||e.call(this,{overall:this.progressData.overall,bars:{}})}findAllReplacements(e,t){void 0===e&&(e=this.dom.documentElement),t=this.appendNodeReplacements(e,t);for(let n=0;n<e.childNodes.length;n++)t=this.findAllReplacements(e.childNodes[n],t);return t}appendNodeReplacements(e,t){let n=[...t];if(e.nodeType===Node.ELEMENT_NODE){for(let t of k)if(e.hasAttribute(t)){let i=e.getAttribute(t);if(void 0===n.find(e=>e.key===i)){let e=async()=>{try{return await this.zcs.getAsUrl(i,(e,t,n)=>{this.updateProgress(e,t,n)})}catch(e){throw console.error("Error fetching ".concat(t,": ").concat(i),e),e}},r={key:i,getUrlPromise:e,targets:[],attempts:0};n.push(r)}n.find(e=>e.key===i).targets.push({element:e,attribute:t})}for(let t of S)if(e.hasAttribute(t)){let i=e.getAttribute(t);if(i.includes("url(")){let r=i.match(/url\(([^)]+)\)/)[1];if(r=w().trim(r,"\"' ()"),void 0===n.find(e=>e.key===r)){let e=async()=>{try{return await this.zcs.getAsUrl(r,(e,t,n)=>{this.updateProgress(e,t,n)})}catch(e){throw console.error("Error fetching ".concat(t,": ").concat(r),e),e}},i={key:r,getUrlPromise:e,targets:[],attempts:0};n.push(i)}n.find(e=>e.key===r).targets.push({element:e,attribute:t})}}}return n}async replaceAllReplacements(e){do{let t=e.filter(e=>this.shouldTryAgain(e)),n=await Promise.all(t.map(e=>this.replace(e)));if(n.some(e=>!e.succeeded)){let e=n.filter(e=>!1===e.succeeded);console.warn("".concat(e.length," failed replacements"),e),await new Promise(e=>setTimeout(e,1e3))}}while(e.some(e=>this.shouldTryAgain(e)));if(e.some(e=>!1===e.succeeded)){let t=e.filter(e=>!1===e.succeeded);console.error("".concat(t.length," replacements failed"),t)}return new XMLSerializer().serializeToString(this.dom)}async replace(e){try{e.attempts++;let t=await e.getUrlPromise();for(let n of e.targets){let i=n.element.getAttribute(n.attribute),r=null==i?void 0:i.replace(e.key,t);n.element.setAttribute(n.attribute,r)}e.succeeded=!0}catch(t){console.warn("Error fetching ".concat(e.key),t),e.succeeded=!1,e.error=t}finally{return e}}shouldTryAgain(e){return!0!==e.succeeded&&e.attempts<3}constructor(e,t,n){this.source=e,this.zcs=t,this.onUpdate=n,this.progressData={overall:{completed:0,total:0},bars:{}},this.dom=new DOMParser().parseFromString(e,"text/xml"),this.reset()}}var C=n(75511),D=n(53463),I=n(71359),E=n(79418),A=n(45080),q=n(76548),P=n(31193),_=n(80511),T=n(94547);let R={key:"gender",label:"Gender",layout:"column",groups:[{label:"Gender",choices:[{display:"Female",key:"f"},{display:"Male",key:"m"},{display:"Non-binary",key:"nb"},{display:"I would rather not say",key:"prefer-not-to-say"}]}]},F={key:"age",label:"Age range",layout:"grid",layoutProps:{columns:2},groups:[{label:"Age",choices:[{display:"14 - 17",key:"14-17"},{display:"18 - 25",key:"18-25"},{display:"26 - 35",key:"26-35"},{display:"36 - 45",key:"36-45"},{display:"46 - 55",key:"46-55"},{display:"56 - 65",key:"56-65"},{display:"66 - 75",key:"66-75"},{display:"76+",key:"76+"},{display:"I would rather not say",key:"prefer-not-to-say"}]}]},N={key:"ethnicity",label:"Ethnicity",layout:"row",groups:[{label:"Asian or Asian British",choices:[{display:"Indian",key:"Indian"},{display:"Pakistani",key:"Pakistani"},{display:"Bangladeshi",key:"Bangladeshi"},{display:"Chinese",key:"Chinese"},{display:"Any other Asian background",key:"Any other Asian background"}]},{label:"Black, Black British, Caribbean or African",choices:[{display:"Caribbean",key:"Caribbean"},{display:"African",key:"African"},{display:"Any other Black, Black British, or Caribbean background",key:"Any other Black, Black British, or Caribbean background"}]},{label:"Mixed or multiple ethnic groups",choices:[{display:"White and Black Caribbean",key:"White and Black Caribbean"},{display:"White and Black African",key:"White and Black African"},{display:"White and Asian",key:"White and Asian"},{display:"Any other Mixed or multiple ethnic background",key:"Any other Mixed or multiple ethnic background"}]},{label:"White",choices:[{display:"English, Welsh, Scottish, Northern Irish or British",key:"English, Welsh, Scottish, Northern Irish or British"},{display:"Irish",key:"Irish"},{display:"Gypsy or Irish Traveller",key:"Gypsy or Irish Traveller"},{display:"Roma",key:"Roma"},{display:"Any other White background",key:"Any other White background"}]},{label:"Other ethnic group",choices:[{display:"Arab",key:"Arab"},{display:"Any other ethnic group",key:"Any other ethnic group"}]},{label:"Unavailable",choices:[{display:"I would rather not say",key:"prefer-not-to-answer"}]}]};var U=n(42410),B=n(74382),W=n(48620),V=n(58433);function M(e){let t=e.demographic.groups.length>1;return(0,f.jsxs)(P.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"stretch",gap:1},children:[(0,f.jsxs)(P.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[(0,f.jsx)(q.Z,{color:"buttonStandard",variant:"text",onClick:()=>e.onBack(),children:(0,f.jsx)("img",{src:"/icons/arrow-left.svg",alt:"Back"})}),(0,f.jsx)(_.Z,{variant:"slideSubHeading",align:"left",children:e.demographic.label})]}),e.demographic.groups.map(n=>(0,f.jsxs)(P.Z,{display:"flex",flexDirection:"column",alignContent:"start",children:[t&&(0,f.jsx)(_.Z,{variant:"slideSectionHeading",align:"left",children:n.label}),("row"===e.layout||"column"===e.layout)&&(0,f.jsx)(P.Z,{display:"flex",flexDirection:e.layout,gap:1,flexWrap:"row"===e.layout?"wrap":void 0,alignItems:"column"===e.layout?"start":void 0,children:n.choices.map(t=>{var i;return(0,f.jsx)(q.Z,{variant:"contained",color:(null===(i=e.currentSelection)||void 0===i?void 0:i.key)===t.key?"buttonStandard":"buttonQuiet",onClick:()=>{e.onSelection(t)},children:(0,f.jsx)(_.Z,{variant:"submitButton",children:t.display})},"".concat(e.demographic.label,"-section-").concat(n.label,"-value-").concat(t.key))})}),"grid"===e.layout&&(0,f.jsx)(V.ZP,{container:!0,sx:{width:e.layoutProps.columns<3?"66%":"100%"},rowGap:1,children:n.choices.map(t=>{var i;return(0,f.jsx)(V.ZP,{item:!0,xs:12/e.layoutProps.columns,sx:{px:1},children:(0,f.jsx)(q.Z,{variant:"contained",fullWidth:!0,color:(null===(i=e.currentSelection)||void 0===i?void 0:i.key)===t.key?"buttonStandard":"buttonQuiet",onClick:()=>{e.onSelection(t)},children:(0,f.jsx)(_.Z,{variant:"submitButton",sx:{py:1},children:t.display})})},"".concat(e.demographic.label,"-section-").concat(n.label,"-value-").concat(t.key))})})]},"".concat(e.demographic.label,"-section-").concat(n.label)))]})}function L(e){var t,n,i,r;let s;let o=(0,x.useContext)(B.v1),[a,l]=(0,x.useState)((0,B.Zp)(o.allAnswers[e.qids.qid],e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[c,d]=(0,x.useState)(!1),[u,h]=(0,x.useState)(!1),[p,g]=(0,x.useState)((s=[],(null===(n=e.showGender)||void 0===n||n)&&s.push(R),(null===(i=e.showAge)||void 0===i||i)&&s.push(F),(null===(r=e.showEthnicity)||void 0===r||r)&&s.push(N),[...s,...e.customDemographics])),[m,y]=(0,x.useState)(),[v,b]=(0,x.useState)({});(0,x.useEffect)(()=>{let e={};(null==a?void 0:a.jsonValue)&&a.jsonValue.answers.forEach(t=>{e[t.key]={key:t.optionKey,display:t.stringValue}}),b(e)},[a]),(0,x.useEffect)(()=>{let t=w().every(p,e=>v.hasOwnProperty(e.key));h(e.role===T._b.Client&&t)},[v]);let j=async()=>{if(e.role!==T._b.Client)console.warn("Only participants can submit answers");else{let t={...a,jsonValue:{answers:Object.entries(v).map(e=>({key:e[0],optionKey:e[1].key,stringValue:e[1].display}))}};d(!0),e.onAnswer(t).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),e)l(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{d(!1)})}},k=!1===e.opaqueInputBox?void 0:{background:"white"},S=e=>{var t;return(0,f.jsx)(q.Z,{color:"buttonStandard",variant:"outlined",sx:{alignSelf:"stretch",py:0,...e.inputBoxSx},onClick:()=>e.onClick(),children:(0,f.jsxs)(P.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",flexGrow:1,justifyContent:"space-between"},children:[(0,f.jsxs)(P.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:0},children:[void 0!==e.display&&(0,f.jsx)(_.Z,{variant:"selectTiny",children:e.label}),(0,f.jsx)(_.Z,{variant:"selectLarge",component:"div",children:null!==(t=e.display)&&void 0!==t?t:e.label})]}),(0,f.jsx)("img",{src:"/icons/select-down.svg"})]})})};return(0,f.jsxs)(f.Fragment,{children:[void 0===m&&(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(P.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.question&&(0,f.jsx)(W.Z,{content:e.question}),p.map(e=>(0,f.jsx)(S,{label:e.label,display:v.hasOwnProperty(e.key)?v[e.key].display:void 0,onClick:()=>{y(e)},inputBoxSx:k},"overview-demographic-".concat(e.key))),(0,f.jsx)(P.Z,{sx:{alignSelf:"stretch",mt:2},children:(0,f.jsx)(U.Z,{enabled:u,inline:!1,alignment:"right",busy:c,onSubmit:()=>j()})})]})}),void 0!==m&&(0,f.jsx)(f.Fragment,{children:(0,f.jsx)(M,{demographic:m,currentSelection:v[m.key],onBack:()=>{y(void 0)},onSelection:e=>{b({...v,[m.key]:e}),y(void 0)},layout:m.layout,layoutProps:m.layoutProps})})]})}function O(e){return(0,f.jsx)("img",{className:"stretch",style:{width:"100%",height:"100%",...e.style},src:e.src})}function z(e){let[t,n]=(0,x.useState)(e.sideSx),[i,r]=(0,x.useState)(e.mainSx);return(0,x.useEffect)(()=>{void 0!==e.sideBackgroundImage&&n({backgroundImage:"url(".concat(e.sideBackgroundImage,")"),...e.sideSx}),void 0!==e.mainBackgroundImage&&r({backgroundImage:"url(".concat(e.mainBackgroundImage,")"),...e.mainSx})},[]),(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(P.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"row"},children:[(0,f.jsx)(P.Z,{sx:{width:"35%",display:"block",...e.sideSx},children:e.side}),(0,f.jsx)(P.Z,{sx:{px:2,alignSelf:"stretch",display:"block",overflowY:"auto",width:"60%",...e.mainSx},children:e.main})]})})}function G(e){let t=()=>!!(null==r?void 0:r.jsonValue),n=(0,x.useContext)(B.v1),i=()=>(0,B.UJ)(n.allAnswers[e.qids.qid],e.qids),[r,s]=(0,x.useState)(i()),[o,a]=(0,x.useState)(t()?1:0),[l,c]=(0,x.useState)();return(0,x.useEffect)(()=>{s(i())},[n]),(0,x.useEffect)(()=>{a(t()?1:0)},[r]),(0,x.useEffect)(()=>{C.Z.emit({type:C.z.Request_SlideRefresh})},[o]),(0,f.jsxs)(f.Fragment,{children:[0===o&&e.input,1===o&&e.completion]})}function H(e){var t;let{content:n,sx:i}=e;return(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(P.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",...i},children:[(0,f.jsx)(_.Z,{variant:"slideHeading",children:null!==(t=n.message)&&void 0!==t?t:"Thanks!"}),n.factoid&&(0,f.jsx)(_.Z,{variant:"slideBody",sx:{mt:8},children:n.factoid})]})})}function J(e){let{sx:t,children:n}=e;return(0,f.jsx)(P.Z,{className:"stretch",sx:{width:"100%",height:"100%",overflowY:"auto",overflowX:"hidden",display:"block",...t},children:n})}function K(e){let t={...e.sx,color:e.color};return(0,f.jsx)(_.Z,{variant:e.variant,component:"div",sx:t,align:e.align,children:e.children})}(i=c||(c={}))[i.Input=0]="Input",i[i.Completion=1]="Completion";var Y=n(30089);function Q(e){let t={backgroundImage:"url('".concat(e.src,"')")};return(0,f.jsx)(f.Fragment,{children:(0,f.jsx)(P.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"block",...t,...e.sx},children:e.children})})}function X(e){return(0,f.jsx)("img",{src:e.src,style:e.style})}var $=n(22960);function ee(e){var t;let n=(0,x.useContext)(B.v1),[i,r]=(0,x.useState)({qid:e.qids.qid,answers:null!==(t=n.allAnswers[e.qids.qid])&&void 0!==t?t:[]}),s=(0,$.Z)();return(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(P.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",overflowX:"hidden",overflowY:"auto"},children:[e.question&&(0,f.jsx)(W.Z,{content:e.question}),(0,f.jsx)(P.Z,{display:"flex",flexDirection:"column",alignItems:"center",children:null==i?void 0:i.answers.map((t,n)=>{var i;return(0,f.jsx)(f.Fragment,{children:null===(i=t.jsonValue)||void 0===i?void 0:i.answers.map(t=>(0,f.jsx)(f.Fragment,{children:(0,f.jsx)(P.Z,{sx:{mb:4,px:2,mx:8},className:"shadow",style:{background:"white",border:"solid 2px",borderColor:n%2==0?s.palette.primary.main:s.palette.secondary.main,borderRadius:12,transform:"rotate(".concat(n%2==0?1.5:-1.5,"deg)")},children:(0,f.jsx)(_.Z,{variant:"slideBody",children:t.stringValue})},"speech-bubble-".concat(e.qids.qid,"-").concat(t.key))}))})})})]})})}function et(e){let{sx:t,children:n}=e;return(0,f.jsx)(P.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",...t},children:(0,f.jsx)(P.Z,{alignSelf:"center",display:"inline-block",textAlign:"center",children:n})})}function en(e){let t=(0,$.Z)(),n=90-90/e.options.filter(e=>!e.isAlt).length;return(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(P.Z,{sx:{width:"100%",height:"100%",className:"stretch",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,f.jsx)(P.Z,{display:"flex",flexDirection:"row",justifyContent:"center",sx:{gap:1,width:"".concat(n,"%")},children:e.options.filter(e=>!e.isAlt).map((n,i)=>{let r=e.currentlySelectedValues.find(e=>e===n.key);return(0,f.jsxs)(P.Z,{sx:{borderRadius:4,px:1,flexGrow:1,flexBasis:0},style:{minHeight:200,border:"solid 4px",background:r?t.palette.optionButtonSelected.main:t.palette.optionButtonUnselected.main,borderColor:r?t.palette.optionButtonSelectedBorder.main:"transparent",cursor:"pointer"},display:"flex",flexDirection:"column",justifyContent:"center",onClick:()=>e.onSelectionClick(n.key),children:[!!n.graphic&&(0,f.jsx)("img",{src:n.graphic,style:{alignSelf:"center",width:"50%"},alt:"".concat(n.display)}),(0,f.jsx)(_.Z,{variant:"submitButton",sx:{textWrap:"pretty"},children:n.display})]},"option-".concat(n.key,"-").concat(e.qid))})}),(0,f.jsx)(P.Z,{display:"flex",flexDirection:"column",alignItems:"center",sx:{mt:3},children:e.options.filter(e=>e.isAlt).map((n,i)=>{let r=e.currentlySelectedValues.find(e=>e===n.key);return(0,f.jsx)(P.Z,{sx:{p:2,borderRadius:4},style:{background:r?t.palette.optionButtonSelected.main:"transparent",border:"solid 4px transparent",borderColor:r?t.palette.optionButtonSelectedBorder.main:"transparent",cursor:"pointer"},onClick:()=>e.onSelectionClick(n.key),display:"flex",flexDirection:"column",justifyContent:"center",children:(0,f.jsx)(_.Z,{variant:"submitButton",style:{borderBottom:"solid 1px black"},children:n.display})},"option-".concat(n.key,"-").concat(e.qid))})}),e.showSubmit&&(0,f.jsx)(P.Z,{display:"flex",flexDirection:"row",justifyContent:"center",sx:{mt:4},children:(0,f.jsx)(U.Z,{busy:e.busy,inline:!1,enabled:e.enableSubmit,onSubmit:e.onSubmit})})]})})}var ei=n(33351);function er(e){let t=e.layoutParams.length>0?parseInt(e.layoutParams[0]):6,n=(0,$.Z)();return(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(ei.Z,{sx:{width:"100%",height:"100%",className:"stretch",display:"flex",flexDirection:"column",justifyContent:"center"},children:[(0,f.jsx)(V.ZP,{container:!0,spacing:1,children:e.options.map((i,r)=>{let s=e.currentlySelectedValues.find(e=>e===i.key);return(0,f.jsx)(V.ZP,{item:!0,xs:t,display:"flex",flexDirection:"column",alignContent:"stretch",children:(0,f.jsx)(q.Z,{variant:"contained",style:{display:"flex",flexDirection:"column",justifyContent:"center",border:"solid 4px",background:s?n.palette.optionButtonSelected.main:n.palette.optionButtonUnselected.main,borderColor:s?n.palette.optionButtonSelectedBorder.main:"transparent",color:"black"},onClick:()=>e.onSelectionClick(i.key),children:(0,f.jsx)(_.Z,{variant:"submitButton",children:i.display})})},"answer-".concat(e.qid,"-").concat(i.key))})}),e.showSubmit&&(0,f.jsx)(ei.Z,{display:"flex",flexDirection:"row",justifyContent:"flex-end",sx:{mt:4},children:(0,f.jsx)(U.Z,{busy:e.busy,inline:!1,enabled:e.enableSubmit,onSubmit:e.onSubmit})})]})})}function es(e){let t=(0,$.Z)();return(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(ei.Z,{sx:{width:"100%",height:"100%",className:"stretch",display:"flex",flexDirection:"column"},children:[(0,f.jsx)(ei.Z,{sx:{display:"flex",flexDirection:"row",flexWrap:"wrap",gap:1},children:e.options.map((n,i)=>{let r=e.currentlySelectedValues.find(e=>e===n.key);return(0,f.jsx)(q.Z,{variant:"contained",style:{display:"flex",flexDirection:"column",justifyContent:"center",border:"solid 4px",background:r?t.palette.optionButtonSelected.main:t.palette.optionButtonUnselected.main,borderColor:r?t.palette.optionButtonSelectedBorder.main:"transparent",color:"black"},onClick:()=>e.onSelectionClick(n.key),children:(0,f.jsx)(_.Z,{variant:"submitButton",children:n.display})},"answer-".concat(e.qid,"-").concat(n.key))})}),e.showSubmit&&(0,f.jsx)(ei.Z,{display:"flex",flexDirection:"row",justifyContent:"flex-end",sx:{mt:4},children:(0,f.jsx)(U.Z,{busy:e.busy,inline:!1,enabled:e.enableSubmit,onSubmit:e.onSubmit})})]})})}let eo=(e,t)=>t.filter(t=>!!e.find(e=>e===t.key));function ea(e){var t;let n=(0,x.useContext)(B.v1),[i,r]=(0,x.useState)((0,B.Zp)(n.allAnswers[e.qids.qid],e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[s,o]=(0,x.useState)([]);(0,x.useEffect)(()=>{var t,n;o(eo(null!==(n=null===(t=i.jsonValue)||void 0===t?void 0:t.answers.filter(e=>!0===e.booleanValue).map(e=>e.key))&&void 0!==n?n:[],e.options))},[i]);let[a,l]=(0,x.useState)(!1),c=e.role===T._b.Client,d=()=>s.length>=e.minSelections&&s.length<=e.maxSelections,u=async()=>{if(d())try{l(!0);var t={...i,jsonValue:{answers:s.map(t=>({key:t.key,booleanValue:!0,numericValue:1,index:e.options.findIndex(e=>e.key===t.key)}))}},n=await e.onAnswer(t);if(console.debug("Answer submitted ".concat(n?"ok":"error")),console.debug("Received answer response",n),n)r(n);else throw"No response received"}catch(e){console.error("Error submitting answer",e)}finally{l(!1)}},h=t=>{console.debug("Selection clicked: "+t);let n=e.options.find(e=>e.key===t);if(void 0===n)throw"Cannot identify this option from props.options";if(s.find(e=>e.key===t))o(s.filter(e=>e.key!==t));else if(s.length>=e.maxSelections){let e=s.find(e=>e.key!==t);o([...s.filter(t=>t!==e),n])}else o([...s,n])},p=()=>({onSubmit:u,onSelectionClick:h,qid:e.qids.qid,options:e.options,busy:a,showSubmit:c,enableSubmit:d(),minSelections:e.minSelections,maxSelections:e.maxSelections,currentlySelectedValues:s.map(e=>e.key),layoutParams:e.layoutParams}),[g,m]=(0,x.useState)(p());return(0,x.useEffect)(()=>{m(p())},[a,s]),(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(P.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:[e.question&&(0,f.jsx)(W.Z,{content:e.question}),(0,f.jsxs)(P.Z,{sx:{flexGrow:1,display:"block"},children:["yes-no-unsure"===e.layout&&(0,f.jsx)(en,{...g}),"button-grid"===e.layout&&(0,f.jsx)(er,{...g}),"buttons-inline"===e.layout&&(0,f.jsx)(es,{...g})]})]})})}function el(e){let t=(0,$.Z)(),n=void 0===e.chartBackground||e.chartBackground;return(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(P.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1,overflowY:"hidden"},children:[e.title&&(0,f.jsx)(K,{variant:"summaryTitle",sx:{p:0,px:1},align:"left",children:e.title}),e.prompt&&(0,f.jsx)(K,{variant:"summaryPrompt",sx:{p:0,px:1},align:"left",children:e.prompt}),(0,f.jsx)(P.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"row",gap:1,alignItems:"stretch",overflowY:"hidden"},children:e.children.map((e,i)=>(0,f.jsx)(P.Z,{sx:{background:n?t.palette.summaryChartBackground.main:void 0,borderRadius:n?4:void 0,flexGrow:1,flexBasis:0,p:2,display:"block",overflow:"auto"},children:e},"summary-slide-child-".concat(i)))})]})})}var ec=n(40468),ed=n(67506),eu=n(37471),eh=n(60182),ep=n(4766);function eg(e){(0,x.useContext)(ep.X);let t=(0,x.useContext)(v.H);(0,x.useContext)(eh.d);let n=(0,x.useContext)(ed.G),i=(0,x.useContext)(eu.Z);(0,x.useContext)(m.A);let[r,s]=(0,x.useState)(0),o={videoId:e.videoId,modeChange:0,modeChangePosition_s:0,modeChangeServerTime_ms:Date.now()},[a,l]=(0,x.useState)(o),[c,d]=(0,x.useState)(),[u,h]=(0,x.useState)(0),[p,g]=(0,x.useState)(!1),y=(0,x.useRef)(null),b=function(e){let[t,n]=(0,x.useState)(!1),i=(0,x.useMemo)(()=>new IntersectionObserver(e=>{let[t]=e;return n(t.isIntersecting)}),[e]);return(0,x.useEffect)(()=>(i.observe(e.current),()=>i.disconnect()),[]),t}(y),[w,j]=(0,x.useState)();(0,x.useEffect)(()=>(C.Z.on(C.z.WSS_Distribute_Message,j),()=>{C.Z.off(C.z.WSS_Distribute_Message,j)}),[]),(0,x.useEffect)(()=>{if(void 0!==w&&w.type===C.z.WSS_Distribute_Message){var t;let n=w.data;"video-sync-update"===n.type&&(null===(t=n.data)||void 0===t?void 0:t.videoId)===e.videoId&&l(n.data)}},[w]),(0,x.useEffect)(()=>{if(b)switch(r){case 0:D().then(()=>s(1)).catch(e=>{console.error(e),s(2)});break;case 1:k().then(()=>s(3)).catch(e=>{console.error(e),s(2)})}else S(),s(1)},[r,b]);let k=async()=>{if(null===y.current)throw Error("Player not ready");console.debug("Loading video: ".concat(e.videoId,"...")),y.current.setAttribute("src",e.videoUri),y.current.load(),console.debug("Video load complete: ".concat(e.videoId))},S=async()=>{y.current&&(console.debug("Unloading video: ".concat(e.videoId,"...")),y.current.removeAttribute("src"),y.current.load(),console.debug("Video unload complete: ".concat(e.videoId)))},Z=(0,x.useCallback)(()=>{if(document.hidden);else try{switch(a.modeChange){case 2:case 3:A(a);break;case 1:I(a)}}catch(e){console.warn("Error syncing video",e)}},[a,e.videoId]);(0,x.useEffect)(()=>{document.addEventListener("visibilitychange",()=>Z())},[]);let D=async()=>{if(null===y.current)throw Error("Player not ready");y.current.addEventListener("play",()=>{h(1)}),y.current.addEventListener("pause",()=>{h(0)}),y.current.addEventListener("ended",()=>{h(0)})};(0,x.useEffect)(()=>{if(null!==y.current&&3===r&&a.videoId===e.videoId){console.debug("video sync",a);try{switch(a.modeChange){case 2:case 3:A(a);break;case 1:I(a)}}catch(e){console.warn("Error syncing video",e)}}},[a,r,y.current]);let I=async e=>{if(console.debug("Play state..."),null===y.current)return;let t=n.fromServerTime(e.modeChangeServerTime_ms),i=Date.now();if(t<=i){let n=i-t;console.debug("State change was ".concat(n,"ms in the past...")),E(e.modeChangePosition_s+n/1e3)}if(t>i){void 0!==c&&clearTimeout(c);let n=t-i;console.debug("State change ".concat(n,"ms in the future...")),n<0&&console.warn("State change projected into the past with a negative delay.");let r=setTimeout(()=>{d(void 0),E(e.modeChangePosition_s)},n);d(r)}},E=async t=>{if(console.debug("Playing video",e.videoId,t),null===y.current){console.warn("Cannot play - no player reference available.");return}if(y.current.currentTime=t,y.current.paused)try{y.current.muted=!0,console.debug("Starting player from paused. Ready state is: ".concat(y.current.readyState));let e=Date.now();await y.current.play();let n=Date.now()-e;console.debug("Play start duration: ".concat(n,"ms"));let i=t+n/1e3;i<0&&console.warn("Post play correction: negative position."),i>y.current.duration&&console.warn("Post play correction: position exceeds duration."),i>0&&y.current.duration>i&&(console.debug("Post play correction: local position out by ".concat(y.current.currentTime-i,"ms")),y.current.currentTime=i)}catch(e){console.error("Cannot play video",e)}finally{y.current.muted=!e.audio}},A=e=>{null===y.current||(y.current.currentTime=e.modeChangePosition_s,y.current.paused||y.current.pause())},_=async(t,i)=>{if(null===y.current)return!1;try{g(!0);let r=y.current.currentTime,s={videoId:e.videoId,modeChange:t,modeChangePosition_s:r,modeChangeServerTime_ms:n.toServerTime(null!=i?i:Date.now())};return await T(s)}catch(e){return console.error(e),!1}finally{g(!1)}},T=async e=>{let n={sessionId:t.sid,action:"send",type:"video-sync-update",data:e};try{return await i.sendMessage(n)}catch(e){return console.error("Video sync wss error: ".concat(e)),!1}},R=async()=>{if(null===y.current)return;let e=y.current.paused?1:2,t=1===e?Date.now()+2e3:void 0;await _(e,t)?console.debug("Video sync send ok"):console.error("Video sync send failed")},F=async()=>{if(null===y.current)return;let e=y.current.currentTime-15;e<0&&(e=0),y.current.currentTime=e,await _(2)?console.debug("Video sync send ok"):console.error("Video sync send failed")},N=async()=>{if(null===y.current)return;let e=y.current.currentTime+15;e>y.current.duration&&(e=y.current.duration),y.current.currentTime=e,await _(2)?console.debug("Video sync send ok"):console.error("Video sync send failed")},U=async()=>{null!==y.current&&(y.current.currentTime=0,await _(2)?console.debug("Video sync send ok"):console.error("Video sync send failed"))};return(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(P.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center"},children:[2!==r&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("video",{ref:y,poster:e.posterUri,preload:"auto",loop:!1,autoPlay:!1,controls:!1,muted:!0,crossOrigin:"anonymous",style:{flexGrow:1},playsInline:!0,"webkit-playsinline":"true"}),e.controls&&null!==y.current&&(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(P.Z,{display:"flex",flexDirection:"row",alignSelf:"stretch",justifyContent:"center",sx:{gap:2,mt:1},children:[(0,f.jsx)(q.Z,{variant:"outlined",disabled:p,onClick:U,children:"Restart"}),(0,f.jsx)(q.Z,{variant:"outlined",disabled:p,onClick:F,children:"-15s"}),void 0!==c&&(0,f.jsx)(ec.Z,{variant:"indeterminate"}),(0,f.jsx)(q.Z,{variant:0===u?"contained":"outlined",disabled:p,onClick:R,children:'"play/pause"'}),(0,f.jsx)(q.Z,{variant:"outlined",disabled:p,onClick:N,children:"+15s"})]})})]}),2===r&&(0,f.jsx)("p",{children:"Failed to initialise video."})]})})}(r=d||(d={}))[r.NotStarted=0]="NotStarted",r[r.Playing=1]="Playing",r[r.Paused=2]="Paused",r[r.Ended=3]="Ended",(s=u||(u={}))[s.Init=0]="Init",s[s.Loading=1]="Loading",s[s.InitError=2]="InitError",s[s.Ready=3]="Ready",(o=h||(h={}))[o.Paused=0]="Paused",o[o.Playing=1]="Playing";var ef=n(14874),ex=n(40772);function em(e){let t=(0,x.useContext)(B.v1);(0,x.useEffect)(()=>{console.debug("InputSequence qids",e.qids.map(e=>e.qid))},[]);let n=e=>{let n=(0,B.UJ)(t.allAnswers[e.qid],e);return(null==n?void 0:n.jsonValue)!==void 0},i=()=>{for(let t of e.qids)if(!n(t))return e.qids.indexOf(t)},[r,s]=(0,x.useState)(i());(0,x.useEffect)(()=>{let e=i();r!==e&&s(e)},[t.allAnswers]);let o=(0,ef.Z)(),a=[.3,.4],[l]=(0,ex.u)({duration:500});return(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(P.Z,{ref:l,className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"stretch",p:2,gap:2,boxSizing:"border-box"},children:[void 0!==r&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(W.Z,{content:e.question}),(0,f.jsx)(P.Z,{sx:{flexGrow:1,boxSizing:"border-box",overflowY:"auto",overflowX:"hidden",display:"block"},children:e.inputs[r]},"input-sequence-element-".concat(e.qids[r].qid))]}),void 0===r&&(0,f.jsx)(P.Z,{sx:{flexGrow:1,display:"block"},children:e.completion}),void 0!==r&&e.showProgress&&(0,f.jsx)(P.Z,{sx:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:w().range(0,e.inputs.length).map((t,n)=>(0,f.jsx)(P.Z,{sx:{background:t===r?o.palette.progressBlipSelected.main:o.palette.progressBlipUnselected.main,width:"".concat(a[t===r?1:0],"em"),height:"".concat(a[t===r?1:0],"em"),borderRadius:"".concat(a[t===r?1:0]/2,"em")}},"sequence-blip-".concat(t,"-").concat(e.qids[t].qid)))})]})})}var ey=n(34990),ev=n(60335);(a=p||(p={}))[a.Yes=0]="Yes",a[a.No=1]="No",a[a.Unsure=2]="Unsure";let eb=e=>0===e?1:1===e?-1:0,ew=e=>1===e?0:-1===e?1:2;function ej(e){var t;let n=(0,x.useContext)(B.v1),[i,r]=(0,x.useState)((0,B.Zp)(n.allAnswers[e.qids.qid],e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[s,o]=(0,x.useState)(i),[a,l]=(0,x.useState)(!1),c=e.role===T._b.Client;(0,x.useEffect)(()=>{o({...i})},[i]);let d=async e=>{if(c&&!a){let t={...s,jsonValue:{answers:[{key:"vote",stringValue:p[e],numericValue:eb(e)}]}};await u(t)}},u=async t=>{try{l(!0);let n=await e.onAnswer(t);if(null!==n)r(n);else throw"Failed to submit answer"}catch(e){console.error(e)}finally{l(!1)}},h=(0,ef.Z)();return(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(P.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:[(0,f.jsx)(W.Z,{content:e.question}),(0,f.jsxs)(P.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,f.jsxs)(ey.Z,{elevation:0,sx:{p:4,mb:2,width:"60%",height:"70%",alignSelf:"center",minHeight:200,borderRadius:4,background:h.palette.promptPanelBackground.main,display:"flex",flexDirection:"row",alignContent:"center",justifyContent:"stretch"},children:[(0,f.jsx)(P.Z,{sx:{display:"flex",flexDirection:"column",justifyContent:"center"},children:(0,f.jsx)("div",{style:{position:"absolute",width:"15%",height:"20%",padding:0,margin:0},children:(0,f.jsx)(ev.Z,{sx:{position:"relative",left:"-100%",top:0,width:"100%",height:"100%",m:0,p:0},onClick:()=>d(1),disabled:!c||a,style:{opacity:c&&!a?1:.5},children:(0,f.jsx)("img",{src:"/icons/updown/cross.svg"})})})}),(0,f.jsx)(P.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",justifyContent:"center",p:2},children:(0,f.jsx)(_.Z,{variant:"upDownQuestion",sx:{textAlign:"center",alignSelf:"center"},children:e.assertion})}),(0,f.jsx)(P.Z,{sx:{display:"flex",flexDirection:"column",justifyContent:"center"},children:(0,f.jsx)("div",{style:{position:"absolute",width:"15%",height:"20%",padding:0,margin:0},children:(0,f.jsx)(ev.Z,{sx:{position:"relative",right:0,top:0,width:"100%",height:"100%",m:0,p:0},style:{opacity:c&&!a?1:.5},onClick:()=>d(0),disabled:!c||a,children:(0,f.jsx)("img",{src:"/icons/updown/check.svg"})})})})]}),(0,f.jsx)(P.Z,{sx:{p:2,borderRadius:4,cursor:"pointer",opacity:c&&!a?1:.5,alignSelf:"center"},onClick:()=>d(2),display:"flex",flexDirection:"column",justifyContent:"center",children:(0,f.jsx)(_.Z,{variant:"submitButton",style:{borderBottom:"solid 1px black"},children:"Unsure"})})]})]})})}function ek(e){let t=(0,$.Z)();return(0,f.jsx)(f.Fragment,{children:(0,f.jsx)(P.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:(0,f.jsxs)(V.ZP,{container:!0,flexGrow:1,children:[(0,f.jsx)(V.ZP,{item:!0,xs:12,sx:{pb:1},children:(0,f.jsxs)(P.Z,{sx:{height:"100%",width:"100%",background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch",overflowX:"hidden",overflowY:"auto"},children:[(0,f.jsxs)(P.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2},children:[(0,f.jsx)("img",{src:"/icons/updown/qmark.svg",alt:"Disagree icon",style:{width:"1em",height:"1em"}}),(0,f.jsx)(K,{variant:"upDownCategory",children:"These statements split the room..."})]}),e.mostDivisive.map((e,n)=>(0,f.jsx)(K,{variant:"upDownQuestion",sx:{background:t.palette.backgroundDivided.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]})}),(0,f.jsx)(V.ZP,{item:!0,xs:6,sx:{pr:1},children:(0,f.jsxs)(P.Z,{sx:{height:"100%",width:"100%",background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch",overflowX:"hidden",overflowY:"auto"},children:[(0,f.jsxs)(P.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2},children:[(0,f.jsx)("img",{src:"/icons/updown/check.svg",alt:"Disagree icon",style:{width:"1em",height:"1em"}}),(0,f.jsx)(K,{variant:"upDownCategory",children:"Most people agreed with..."})]}),e.mostlySupported.map((e,n)=>(0,f.jsx)(K,{variant:"upDownQuestion",sx:{background:t.palette.backgroundAgree.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]})}),(0,f.jsx)(V.ZP,{item:!0,xs:6,sx:{p:0},children:(0,f.jsxs)(P.Z,{sx:{height:"100%",width:"100%",background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch",overflowX:"hidden",overflowY:"auto"},children:[(0,f.jsxs)(P.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2},children:[(0,f.jsx)("img",{src:"/icons/updown/cross.svg",alt:"Disagree icon",style:{width:"1em",height:"1em"}}),(0,f.jsx)(K,{variant:"upDownCategory",children:"Most people disagreed with..."})]}),e.mostlyOpposed.map((e,n)=>(0,f.jsx)(K,{variant:"upDownQuestion",sx:{background:t.palette.backgroundDisagree.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]})})]})})})}function eS(e){let t=(0,$.Z)();return(0,f.jsxs)(P.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[(0,f.jsxs)(P.Z,{sx:{background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch"},children:[(0,f.jsxs)(P.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2},children:[(0,f.jsx)("img",{src:"/icons/updown/qmark.svg",alt:"Disagree icon",style:{width:"1em",height:"1em"}}),(0,f.jsx)(K,{variant:"upDownCategory",children:"These statements split the room..."})]}),e.mostDivisive.map((e,n)=>(0,f.jsx)(K,{variant:"upDownQuestion",sx:{background:t.palette.backgroundDivided.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]}),(0,f.jsxs)(P.Z,{sx:{background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch"},children:[(0,f.jsxs)(P.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2},children:[(0,f.jsx)("img",{src:"/icons/updown/check.svg",alt:"Disagree icon",style:{width:"1em",height:"1em"}}),(0,f.jsx)(K,{variant:"upDownCategory",children:"Most people agreed with..."})]}),e.mostlySupported.map((e,n)=>(0,f.jsx)(K,{variant:"upDownQuestion",sx:{background:t.palette.backgroundAgree.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]}),(0,f.jsxs)(P.Z,{sx:{background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch"},children:[(0,f.jsxs)(P.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2},children:[(0,f.jsx)("img",{src:"/icons/updown/cross.svg",alt:"Disagree icon",style:{width:"1em",height:"1em"}}),(0,f.jsx)(K,{variant:"upDownCategory",children:"Most people disagreed with..."})]}),e.mostlyOpposed.map((e,n)=>(0,f.jsx)(K,{variant:"upDownQuestion",sx:{background:t.palette.backgroundDisagree.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]})]})}function eZ(e){let t=(0,x.useContext)(B.v1),[n,i]=(0,x.useState)([]),[r,s]=(0,x.useState)([]),[o,a]=(0,x.useState)([]),[l,c]=(0,x.useState)([]);return(0,x.useEffect)(()=>{let n=[],r=[],o=[],l=[];Object.entries(t.allAnswers).forEach(t=>{let[i,s]=t;if(void 0!==Object.keys(e.questions).find(e=>e===i)){let t=s.filter(e=>{var t,n;return(null===(n=e.jsonValue)||void 0===n?void 0:null===(t=n.answers[0])||void 0===t?void 0:t.numericValue)!==void 0&&ew(e.jsonValue.answers[0].numericValue)===p.Yes}).length,a=s.filter(e=>{var t,n;return(null===(n=e.jsonValue)||void 0===n?void 0:null===(t=n.answers[0])||void 0===t?void 0:t.numericValue)!==void 0&&ew(e.jsonValue.answers[0].numericValue)===p.No}).length,c=s.filter(e=>{var t,n;return(null===(n=e.jsonValue)||void 0===n?void 0:null===(t=n.answers[0])||void 0===t?void 0:t.numericValue)!==void 0&&ew(e.jsonValue.answers[0].numericValue)===p.Unsure}).length,d=e.questions[i].assertion,u={qid:i,assertion:d,yes:t,no:a,unsure:c},h=t+a;h>0?t>=2*h/3?n=[...n,u]:a>=2*h/3?r=[...r,u]:o=[...o,u]:l=[...l,u]}}),s(n),a(r),i(o),c(l)},[t]),(0,f.jsxs)(f.Fragment,{children:["tshape"===e.layout&&(0,f.jsx)(ek,{mostDivisive:n,mostlySupported:r,mostlyOpposed:o,unanswered:l}),"column"===e.layout&&(0,f.jsx)(eS,{mostDivisive:n,mostlySupported:r,mostlyOpposed:o,unanswered:l})]})}var eC=n(26049),eD=n(45231);function eI(e){let t=(0,x.useContext)(y.rZ),n=(0,x.useContext)(B.v1),i=()=>{var t;return(0,B.Zp)(n.allAnswers[e.qids.qid],e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)},[r,s]=(0,x.useState)(i()),[o,a]=(0,x.useState)(i()),[l,c]=(0,x.useState)(!1),[d,u]=(0,x.useState)(!1),[h,p]=(0,x.useState)(e.points),[g,m]=(0,x.useState)(e.options.map(e=>({min:0,max:e.max}))),[v,b]=(0,x.useState)(e.options.map(()=>0)),j=(e,t)=>{b(v.map((n,i)=>i===t?e:n))};(0,x.useEffect)(()=>{let n=e.points-w().sum(v);p(n);for(let t=0;t<e.options.length;t++)m(g.map((e,t)=>({min:0,max:v[t]+n})));let i={answers:[]};for(let t=0;t<e.options.length;t++)i.answers.push({key:e.options[t].key,description:e.options[t].title,numericValue:v[t]});a({...o,jsonValue:i}),console.debug("available points",n),u(0===n&&t.role!==T._b.Controller)},[v]);let k=async()=>{c(!0),e.onAnswer(o).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),e)s(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{c(!1)})},S=(e,t)=>w().range(e,t+1,1).map((e,t)=>({value:e,label:"".concat(e)})),Z=(0,$.Z)();return(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(P.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[(0,f.jsxs)(P.Z,{sx:{display:"flex",flexDirection:"row",gap:1},children:[e.question&&(0,f.jsx)(W.Z,{content:e.question}),(0,f.jsx)(P.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",alignItems:"end",justifyContent:"end"},children:(0,f.jsxs)(_.Z,{variant:"pointsAllocationCategoryTitle",align:"left",color:Z.palette.secondary.main,children:[h," points remaining"]})})]}),(0,f.jsx)(P.Z,{sx:{display:"flex",flexDirection:"column",gap:1,flexGrow:1,overflowX:"hidden",overflowY:"auto",px:1},children:e.options.map((e,n)=>(0,f.jsxs)(P.Z,{sx:{background:"#f0f0f0",p:2,borderRadius:4,display:"flex",flexDirection:"row",alignItems:"stretch",gap:2},children:[e.graphic&&(0,f.jsx)(P.Z,{sx:{width:"20%",backgroundSize:"cover",backgroundPosition:"center",backgroundImage:"url(".concat(e.graphic,")"),borderRadius:2}}),(0,f.jsxs)(P.Z,{sx:{display:"flex",flexDirection:"column",gap:1,width:"80%"},children:[(0,f.jsx)(_.Z,{variant:"pointsAllocationCategoryTitle",align:"left",children:e.title}),(0,f.jsx)(_.Z,{variant:"pointsAllocationCategoryDescription",align:"left",children:e.description}),(0,f.jsx)(P.Z,{sx:{px:2},children:(0,f.jsx)(eC.Z,{onCommit:e=>{j(e,n)},color:"secondary",sliderDefault:v[n],marks:S(e.min,e.max),slots:{markLabel:eD.A},min:e.min,max:e.max,step:1,sliderMode:"multi",acceptableRange:{min:g[n].min,max:g[n].max},disabled:t.role===T._b.Controller})})]})]},"points-allocation-option-".concat(n)))}),(0,f.jsx)(U.Z,{enabled:d,inline:!1,alignment:"right",busy:l,onSubmit:()=>k()})]})})}function eE(e){let t=(0,x.useContext)(B.v1),n=()=>{var n;return(0,B.Zp)(t.allAnswers[e.qids.qid],e.qids,null===(n=e.question)||void 0===n?void 0:n.pii)},[i,r]=(0,x.useState)(n()),[s,o]=(0,x.useState)(n()),[a,l]=(0,x.useState)(!1),[c,d]=(0,x.useState)(e.role===T._b.Client),[u,h]=(0,x.useState)({});(0,x.useEffect)(()=>{let t={...u};e.options.forEach(e=>{var n,r,s;t[e.key]=null!==(s=null===(r=i.jsonValue)||void 0===r?void 0:null===(n=r.answers.find(t=>t.key===e.key))||void 0===n?void 0:n.numericValue)&&void 0!==s?s:0}),h(t)},[i]);let p=e=>u.hasOwnProperty(e)?u[e]:0;(0,x.useEffect)(()=>{o({...i})},[i]);let g=(t,n)=>{var i,r,a;let l=null!==(r=s.jsonValue)&&void 0!==r?r:{answers:[]};l.answers=l.answers.filter(e=>e.key!==t),l.answers.push({key:t,numericValue:n,description:null!==(a=null===(i=e.options.find(e=>e.key===t))||void 0===i?void 0:i.description)&&void 0!==a?a:"".concat(n),index:n}),o({...s,jsonValue:l})},m=async()=>{e.role!==T._b.Controller&&(l(!0),e.onAnswer(s).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),e)r(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{l(!1)}))};return(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(P.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[e.question&&(0,f.jsx)(W.Z,{content:e.question}),(0,f.jsx)(P.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",gap:1,overflowX:"hidden",overflowY:"auto",justifyContent:"center",px:4},children:(0,f.jsxs)(V.ZP,{container:!0,sx:{alignItems:"center"},children:[(0,f.jsx)(V.ZP,{item:!0,xs:3}),(0,f.jsx)(V.ZP,{item:!0,xs:9,style:{textAlign:"left"},children:e.labels.map((t,n)=>{let i=e.max-e.min,r=t.at-e.min,s=t.at===e.min,o=t.at===e.max;return(0,f.jsx)(P.Z,{style:{position:"relative",left:"".concat(r/i*100,"%")},children:(0,f.jsx)(P.Z,{style:{position:"absolute",transform:s?"translate(0, -0.5em)":o?"translate(-100%, -0.5em)":"translate(-50%, -0.5em)",maxWidth:"".concat(100/e.labels.length,"%")},children:(0,f.jsx)(_.Z,{variant:"body1",component:"div",children:t.text})})},"".concat(e.qids.qid,"-label-").concat(n,"-at-").concat(t.at))})}),e.options.map((t,n)=>(0,f.jsxs)(x.Fragment,{children:[(0,f.jsxs)(V.ZP,{item:!0,xs:3,children:[(0,f.jsx)(_.Z,{variant:"body1",align:"left",component:"div",sx:{pr:3},children:t.title}),e.showDescriptions&&!1]}),(0,f.jsx)(V.ZP,{item:!0,xs:9,children:(0,f.jsx)(eC.Z,{onCommit:e=>{g(t.key,e)},color:"secondary",sliderDefault:p(t.key),marks:!0,min:e.min,max:e.max,step:1,sliderMode:"multi",sx:{mt:1}})})]},"".concat(e.qids.qid,"-option-").concat(t.key)))]})}),e.role===T._b.Client&&(0,f.jsx)(P.Z,{children:(0,f.jsx)(U.Z,{onSubmit:m,text:"Submit",busy:a,enabled:c,inline:!1,alignment:"right"})})]})})}var eA=n(73391);let eq=(e,t)=>{if(!e||0===e.length)return[];let n=new Map;return e.forEach(e=>{var t;null===(t=e.jsonValue)||void 0===t||t.answers.forEach(e=>{var t;let i=e.key,r=null!==(t=e.numericValue)&&void 0!==t?t:0;n.has(i)||n.set(i,0),n.set(i,n.get(i)+r)})}),Array.from(n.entries()).sort((e,t)=>e[1]-t[1]).reverse().slice(0,t).map(e=>({key:e[0],count:e[1]}))},eP=(e,t)=>e.map(e=>({key:e.key,title:t.find(t=>t.key===e.key).title,description:t.find(t=>t.key===e.key).description,graphic:t.find(t=>t.key===e.key).graphic,count:e.count}));function e_(e){let t=(0,x.useContext)(B.v1),[n,i]=(0,x.useState)(t.allAnswers[e.qids.qid]),[r,s]=(0,x.useState)(eq(n,e.displayCount)),[o,a]=(0,x.useState)(eP(r,e.options));(0,x.useEffect)(()=>{i(t.allAnswers[e.qids.qid])},[t.allAnswers]),(0,x.useEffect)(()=>{s(eq(n,e.displayCount))},[n]),(0,x.useEffect)(()=>{a(eP(r,e.options))},[r]);let l=(0,$.Z)();return(0,f.jsxs)(P.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:[e.question&&(0,f.jsx)(W.Z,{content:e.question}),(0,f.jsx)(P.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"row",alignItems:"stretch",justifyContent:"stretch",gap:1},children:o.map((t,n)=>(0,f.jsxs)(P.Z,{sx:{flexGrow:1,flexBasis:0,p:2,borderRadius:2,background:l.palette.summaryChartBackground.main,display:"flex",flexDirection:"column",gap:1,mt:2*n},children:[(0,f.jsx)(_.Z,{variant:"topOptionsOptionRank",align:"left",children:(0,eA.q)(n+1)}),(0,f.jsxs)(_.Z,{variant:"topOptionsOptionPoints",align:"left",children:["Total points: ",t.count]}),(0,f.jsx)(P.Z,{sx:{width:"10%",height:0,border:"4px solid black",borderRadius:"4px",mt:1,mb:3}}),(0,f.jsx)(_.Z,{variant:"topOptionsOptionTitle",align:"left",children:t.title}),void 0!==t.graphic&&(0,f.jsx)(P.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",justifyContent:"end"},children:(0,f.jsx)(P.Z,{sx:{maxHeight:"20vh",height:"20vh",backgroundImage:"url(".concat(t.graphic,")"),backgroundSize:"cover",backgroundPosition:"center",borderRadius:2}})},"".concat(e.qids.qid,"-top-option-").concat(n,"-graphic-").concat(t.key))]},"".concat(e.qids.qid,"-top-option-").concat(n,"-description-").concat(t.key)))})]})}function eT(e){var t;let n=(0,x.useContext)(B.v1),i=(0,x.useContext)(y.rZ),[r,s]=(0,x.useState)((0,B.Zp)(n.allAnswers[e.qids.qid],e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[o,a]=(0,x.useState)(r),[l,c]=(0,x.useState)(i.role!==T._b.Controller),[d,u]=(0,x.useState)(!1);(0,x.useEffect)(()=>{a(r)},[r]);let h=t=>{if(!l)return;u(!0);let n={...o,jsonValue:{answers:[{key:t,booleanValue:!0}]}};e.onAnswer(n).then(e=>{if(e)s(e);else throw"No response from submission"}).catch(e=>{console.error(e)}).finally(()=>{u(!1)})};return(0,f.jsxs)(f.Fragment,{children:[e.question&&(0,f.jsx)(W.Z,{content:e.question}),(0,f.jsx)(P.Z,{sx:{display:"flex",flexDirection:"row",gap:1,justifyContent:e.align},children:e.options.map((t,n)=>{var i;return(0,f.jsx)(q.Z,{variant:(null!==(i=t.variant)&&void 0!==i?i:0===n)?"contained":"outlined",color:t.colour,onClick:()=>h(t.key),disabled:!l||d,children:t.text},"ack-".concat(e.qids.qid,"-option-").concat(t.key))})})]})}var eR=n(84479),eF=n(11020);let eN=(e,t)=>{if(void 0===e.jsonValue||0===e.jsonValue.answers.length)return eB(t);let n=[];return e.jsonValue.answers.forEach(e=>{let i=t.find(t=>t.key===e.key);i&&(n[e.index]=i)}),n},eU=(e,t)=>{let n={answers:[]};return t.forEach((e,t)=>{n.answers.push({key:e.key,index:t,numericValue:t,description:e.title})}),{...e,jsonValue:n}},eB=e=>e.sort((e,t)=>e.startingIndex-t.startingIndex);function eW(e){var t;let n=(0,x.useContext)(B.v1),i=(0,x.useContext)(y.rZ),[r,s]=(0,x.useState)((0,B.Zp)(n.allAnswers[e.qids.qid],e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[o,a]=(0,x.useState)(i.role!==T._b.Controller),[l,c]=(0,x.useState)(!1),[d,u]=(0,x.useState)(eB(e.options));(0,x.useEffect)(()=>{console.debug("RankedList options",e.options)},[]),(0,x.useEffect)(()=>{u(eN(r,e.options))},[r]);let h=e=>{let t=d.findIndex(t=>t.key===e.key);if(t>0){let n=[...d];n.splice(t,1),n.splice(t-1,0,e),u(n)}},p=e=>{let t=d.findIndex(t=>t.key===e.key);if(t<d.length-1){let n=[...d];n.splice(t,1),n.splice(t+1,0,e),u(n)}},g=async()=>{if(i.role===T._b.Client&&o){c(!0);let t=eU(r,d);e.onAnswer(t).then(t=>{if(console.debug("Answer submitted ".concat(t?"ok":"error")),console.debug("Received answer response",t),null!==t)u(eN(t,e.options));else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{c(!1)})}else console.warn("Only participants can submit answers")},m=(0,$.Z)(),[v]=(0,ex.u)({duration:500});return(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(P.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[(0,f.jsxs)(P.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"row"},children:[e.question&&(0,f.jsx)(P.Z,{sx:{flexGrow:1,flexBasis:0,pr:8},children:(0,f.jsx)(W.Z,{content:e.question})}),(0,f.jsx)(P.Z,{ref:v,sx:{flexGrow:1,flexBasis:0,display:"flex",flexDirection:"column",overflowY:"auto",boxSizing:"border-box"},children:d.map((t,n)=>(0,f.jsxs)(P.Z,{sx:{border:"solid 1px black",borderRadius:2,p:2,display:"flex",flexDirection:"row",gap:1,alignContent:"center",alignItems:"center",background:"white",mb:1,boxSizing:"border-box"},children:[(0,f.jsxs)(P.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",pr:2},children:[t.title&&(0,f.jsx)(_.Z,{variant:"rankedListItemTitle",align:"left",children:t.title}),t.description&&(0,f.jsx)(_.Z,{variant:"rankedListItemDescription",align:"left",children:t.description})]}),(0,f.jsx)(P.Z,{onClick:()=>{h(t)},sx:{display:"flex",flexDirection:"column",background:m.palette.updinkBackground.main,color:m.palette.updinkText.main,p:1,borderRadius:2,cursor:0===n?void 0:"pointer",opacity:0===n?0:1},children:(0,f.jsx)(eR.Z,{sx:{fontSize:"2rem"}})}),(0,f.jsx)(P.Z,{onClick:()=>{p(t)},sx:{display:"flex",flexDirection:"column",background:m.palette.downdinkBackground.main,color:m.palette.downdinkText.main,p:1,borderRadius:2,cursor:n===d.length-1?void 0:"pointer",opacity:n===d.length-1?0:1},children:(0,f.jsx)(eF.Z,{sx:{fontSize:"2rem"}})})]},"ranked-list-".concat(e.qids.qid,"-option-").concat(t.key)))})]}),o&&(0,f.jsx)(P.Z,{sx:{display:"flex",flexDirection:"row",justifyContent:"end",alignSelf:"stretch"},children:(0,f.jsx)(U.Z,{enabled:o,inline:!0,onSubmit:g,busy:l})})]})})}var eV=n(2962);let eM=e=>{let t=parseInt(e.replace("#",""),16);return[t>>16&255,t>>8&255,255&t]},eL=(e,t,n,i)=>{let r=eM(n),s=eM(i),o=Math.round(r[0]+(s[0]-r[0])*e/t),a=Math.round(r[1]+(s[1]-r[1])*e/t),l=Math.round(r[2]+(s[2]-r[2])*e/t);return"rgb(".concat(o,",").concat(a,",").concat(l,")")},eO=e=>{let t={};return e.forEach(e=>{var n;null===(n=e.jsonValue)||void 0===n||n.answers.forEach(e=>{var n;let i=e.key,r=null!==(n=e.numericValue)&&void 0!==n?n:0;t.hasOwnProperty(i)||(t[i]=0),t[i]+=r})}),t},ez=(e,t)=>Object.entries(eO(e)).map(e=>{var n,i,r;return{key:e[0],title:null!==(r=null===(n=t.find(t=>t.key===e[0]))||void 0===n?void 0:n.title)&&void 0!==r?r:"",description:null===(i=t.find(t=>t.key===e[0]))||void 0===i?void 0:i.description,value:e[1]}});function eG(e){var t;let n=(0,x.useContext)(B.v1),[i,r]=(0,x.useState)([]),[s,o]=(0,x.useState)([]),[a,l]=(0,x.useState)([]),c=null!==(t=e.mode)&&void 0!==t?t:"normal";(0,x.useEffect)(()=>{var t;r(null!==(t=n.allAnswers[e.qids.qid])&&void 0!==t?t:[])},[n]),(0,x.useEffect)(()=>{o(ez(i,e.options))},[i]),(0,x.useEffect)(()=>{let t=s.sort((e,t)=>e.value-t.value);"normal"===c&&(t=t.reverse()),l([...t.map((t,n)=>{var i,r;return{backgroundColor:eL(n,s.length,null!==(i=e.startColour)&&void 0!==i?i:d,null!==(r=e.endColour)&&void 0!==r?r:u),textColor:"#000000",option:t}})])},[s]);let d=(0,$.Z)().palette.secondary.main,u="#FFFFFF";return(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(P.Z,{className:"stretch",sx:{width:"100%",height:"100%",flexDirection:"column",display:"flex",gap:1},children:[e.question&&(0,f.jsx)(W.Z,{content:e.question}),(0,f.jsx)(P.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",gap:1,justifyContent:"start"},children:a.map((t,n)=>(0,f.jsx)(P.Z,{sx:{backgroundColor:t.backgroundColor,color:t.textColor,borderRadius:2,display:"flex",flexDirection:"column",p:2},children:(0,f.jsxs)(_.Z,{variant:"orderedListItemTitle",align:"left",children:[n+1,". ",t.option.title]})},"ordered-display-".concat(e.qids.qid,"-option-").concat(t.option.key,"-").concat(n)))})]})})}function eH(e){let t=(0,$.Z)(),n=1===e.headings.filter(e=>e.expanded).length;return(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(P.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[e.question&&(0,f.jsx)(W.Z,{content:e.question}),e.headings.map((i,r)=>(0,f.jsxs)(P.Z,{sx:{flexGrow:i.expanded?1:void 0,flexBasis:i.expanded?0:void 0,display:"flex",flexDirection:"row",gap:2,p:2,alignItems:"stretch",backgroundColor:t.palette.summaryChartBackground.main,borderRadius:4},children:[i.expanded&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(P.Z,{sx:{display:"inline-block",borderRadius:2,flexGrow:0,flexShrink:0,flexBasis:n?"50%":"20%",backgroundImage:"url(".concat(i.graphic,")"),backgroundSize:"cover",backgroundPosition:"center"}}),(0,f.jsxs)(P.Z,{sx:{display:"flex",flexDirection:"column",gap:2,alignSelf:"center"},children:[(0,f.jsx)(_.Z,{variant:"sectionHeadingTitle",align:"left",children:i.title}),i.description&&(0,f.jsx)(_.Z,{variant:"sectionHeadingDescription",align:"left",children:i.description})]})]}),!i.expanded&&(0,f.jsx)(f.Fragment,{children:(0,f.jsx)(_.Z,{variant:"sectionHeadingTitleQuiet",align:"left",children:i.title})})]},"section-heading-".concat(e.uid,"-").concat(r)))]})})}var eJ=n(20920);function eK(e){return(0,f.jsx)(f.Fragment,{children:(0,f.jsx)(P.Z,{sx:{display:"flex",flexDirection:"column",gap:2,...e.sx},children:e.children})})}let eY=e=>({replace:(t,n)=>eQ(t,e)}),eQ=(e,t)=>{if(e instanceof D.W_&&e.attribs){var n;let i;switch(e.tagName.toLowerCase()){case"sidebarlayout":i=tg(e,t);break;case"fullpagescrollinglayout":i=tf(e,t);break;case"fullpagecentredlayout":i=tx(e,t);break;case"columnlayout":i=tm(e,t);break;case"slidebackgroundimage":i=ty(e,t);break;case"imageslide":i=tu(e,t);break;case"videoslide":i=e2(e,t);break;case"summaryslidelayout":i=e5(e,t);break;case"sectionheading":i=tb(e,t);break;case"slidetext":i=tw(e,t);break;case"slideimage":case"img":i=tj(e,t);break;case"inputorcompletion":i=th(e,t);break;case"inputsequence":i=tp(e,t);break;case"sliderinput":i=e3(e,t);break;case"textinput":i=e8(e,t);break;case"demographicinput":i=tn(e,t);break;case"updownvoteinput":i=ti(e,t);break;case"closedchoiceinput":i=tr(e,t);break;case"pointsallocationinput":i=ts(e,t);break;case"multisliderinput":i=to(e,t);break;case"acknowledgementinput":i=ta(e,t);break;case"rankedlistinput":i=tl(e,t);break;case"completion":i=tv(e,t);break;case"speechbubbles":i=e6(e,t);break;case"selectiongraph":i=e4(e,t);break;case"updownvoteresults":i=e7(e,t);break;case"topoptions":i=tc(e,t);break;case"orderedlist":i=td(e,t);break;default:return e}return null!==(n=(0,Y.te)(i,t.keyPrefix))&&void 0!==n?n:i}},eX=(e,t)=>{let n=e.children.map((e,n)=>eY(t).replace(e,n)).filter(e=>null!=e&&!1!==e).map(e=>e instanceof D.W_?(0,D.du)([e],eY(t)):e);return x.Children.toArray(n)},e$=(e,t)=>{let n=[];for(let i of e.children.filter(e=>e instanceof D.W_).map(e=>e))void 0!==i.attribs.qid?n.push(e0(t,i)):n=[...n,...e$(i,t)];return n},e0=(e,t)=>{let n=t.attribs.qid;if(void 0===n)throw console.error("Question id not found for element",t),"Question id not found for element";return{sid:e.sessionId,pid:e.deviceId,qid:n}},e1=e=>{var t,n;let i=e.attribs.instruction,r=null!==(n=null!==(t=e.attribs.question)&&void 0!==t?t:e.attribs.statement)&&void 0!==n?n:e.attribs.prompt,s=e.attribs.explanation,o=(0,E.gx)(e.attribs.pii);return i||r||s||void 0!==o?{instruction:i,question:r,explanation:s,pii:o}:void 0},e2=(e,t)=>{console.debug("Enriching VideoSlide tag as VideoSlide...",e);let n=e.attribs.id,i=e.attribs.videouri,r=e.attribs.posteruri,s=t.role===T._b.Controller,o=t.role===T._b.Controller||t.remoteMedia;return(0,f.jsx)(eg,{videoId:n,role:t.role,controls:s,audio:o,videoUri:i,posterUri:r})},e5=(e,t)=>{console.debug("Enriching SummarySlideLayout tag as SummarySlideLayout...",e);let n=e.attribs.title,i=e.attribs.prompt,r=void 0!==e.attribs.chartbackground?(0,E.gx)(e.attribs.chartbackground):void 0,s=eX(e,t);return(0,f.jsx)(el,{title:n,prompt:i,chartBackground:r,children:s})},e3=(e,t)=>{var n;console.debug("Enriching SliderInput tag as SliderInput...",e);let i=e0(t,e),r=e1(e),s=(0,Y.av)(e.attribs.type),o=s===I.Q.categorical?(0,Y.kh)(e.attribs.marks):void 0,a=s!==I.Q.categorical?null===(n=(0,Y.kh)(e.attribs.range))||void 0===n?void 0:n.map(e=>(0,Y.f_)(e.trim())):void 0,l=s!==I.Q.categorical?(0,Y.f_)(e.attribs.step):void 0;return(0,f.jsx)(I.Z,{qids:i,role:t.role,type:s,marks:o,numericRange:a,numericStep:l,question:r,onAnswer:t.onAnswer})},e4=(e,t)=>{var n;console.debug("Enriching SelectionGraph tag as AnswerGraphMuiChart...",e);let i=e0(t,e),r=e1(e),s=(0,Y.yg)(e.attribs.orientation),o=(0,Y.ot)(e.attribs.type),a=null===(n=(0,Y.kh)(e.attribs.range))||void 0===n?void 0:n.map(e=>w().toNumber(e.trim())),l=(0,Y.tL)((0,Y.kh)(e.attribs.categories));if(i&&void 0!==o)return(0,f.jsx)(eV.Z,{role:t.role,qids:i,question:r,inputType:o,orientation:s,categories:l,range:a?{lo:a[0],hi:a[1],step:a[2]}:void 0});throw console.error("SelectionGraph without qIds, type, or range",e.attribs),"SelectionGraph without qIds, type, or range"},e7=(e,t)=>{console.debug("Enriching UpDownVoteResults tag as UpDownVoteResults...",e);let n=e.attribs.layout,i={};for(let t of e.children)if(t instanceof D.W_&&"result"===t.tagName){let e=t.attribs.qid,n=t.attribs.assertion;void 0!==e&&(i[e]={assertion:n})}return console.debug("UpDownVoteResults questions",i),(0,f.jsx)(eZ,{questions:i,layout:n})},e6=(e,t)=>{console.debug("Enriching SpeechBubbles tag as SpeechBubbles (with children)...",e);let n=e0(t,e),i=e1(e);return(0,f.jsx)(ee,{qids:n,question:i})},e8=(e,t)=>{var n;let i;console.debug("Enriching TextInput tag as TextInput...",e);let r=e0(t,e),s=e1(e),o=(0,Y.H7)(e.attribs.type),a=e.attribs.label,l=e.attribs.help,c=e.attribs.submittext,d=e.attribs.skiptext,u=w().parseInt(e.attribs.mincheckboxes),h=(0,E.gx)(null!==(n=e.attribs.textrequired)&&void 0!==n?n:"true"),p=[];for(let t of e.childNodes)if(t instanceof D.W_&&"information"===t.tagName&&(i={heading:t.attribs.heading,body:t.children}),t instanceof D.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.text,i=(0,E.gx)(t.attribs.required);p.push({key:e,text:n,initial:!1,required:i,checked:!1})}if(void 0===s||void 0===s.pii)throw"pii not defined for TextInput";return(0,f.jsx)(A.Z,{qids:r,role:t.role,type:o,label:a,help:l,textRequired:h,minCheckboxes:u,information:i,onAnswer:t.onAnswer,checkboxes:p,question:s,submitText:c,skipText:d})},e9=e=>{let t=[];for(let n of e)if(n instanceof D.W_&&"demographicinputtype"===n.tagName){let e=n.attribs.key,i=n.attribs.label,r=n.attribs.layout,s=(0,E.LC)(n.attribs.columns);if(e&&i&&r){let o=te(n.children);t.push({key:e,label:i,layout:r,layoutProps:void 0!==s?{columns:s}:void 0,groups:o})}else throw console.warn("DemographicInputType without key, label, or layout",n),"DemographicInput child without key, label, or layout"}return t},te=e=>{let t=[];for(let n of e)if(n instanceof D.W_&&"demographicgroup"===n.tagName){let e=n.attribs.label;if(e){let i=tt(n.children);t.push({label:e,choices:i})}else throw console.warn("DemographicGroup without label",n),"DemographicGroup without label"}return t},tt=e=>{let t=[];for(let n of e)if(n instanceof D.W_&&"demographic"===n.tagName){let e=n.attribs.display,i=n.attribs.value;if(e&&i)t.push({display:e,key:i});else throw console.warn("Demographic without display or value",n),"Demographic without display or value"}return t},tn=(e,t)=>{console.debug("Enriching DemographicInput tag as DemographicInput...",e);let n=e0(t,e),i=e1(e),r=(0,E.gx)(e.attribs.showage),s=(0,E.gx)(e.attribs.showgender),o=(0,E.gx)(e.attribs.showethnicity),a=e9(e.children);return(0,f.jsx)(L,{role:t.role,qids:n,onAnswer:t.onAnswer,question:i,showAge:r,showGender:s,showEthnicity:o,customDemographics:a})},ti=(e,t)=>{console.debug("Enriching UpDownVoteInput tag as UpDownVoteInput...",e);let n=e0(t,e),i=e1(e),r=e.attribs.assertion;return(0,f.jsx)(ej,{qids:n,role:t.role,question:i,assertion:r,onAnswer:t.onAnswer})},tr=(e,t)=>{console.debug("Enriching ClosedChoiceInput tag as ClosedChoiceInput...",e);let n=e0(t,e),i=e1(e),r=parseInt(e.attribs.minselections),s=parseInt(e.attribs.maxselections),o=e.attribs.layout,a=e.attribs.layoutparams,l=a?(0,Y.kh)(a):[],c=[];for(let t of e.children)if(t instanceof D.W_&&"option"===t.tagName){let e=t.attribs.value,n=t.attribs.display,i=t.attribs.graphic,r=(0,E.gx)(t.attribs.isalt);e&&n&&c.push({key:e,display:n,graphic:i,isAlt:r})}return(0,f.jsx)(ea,{qids:n,role:t.role,question:i,options:c,onAnswer:t.onAnswer,layout:o,layoutParams:l,minSelections:r,maxSelections:s,contentStore:t.contentStore})},ts=(e,t)=>{console.debug("Enriching PointsAllocationInput tag as PointsAllocationInput...",e);let n=e0(t,e),i=e1(e),r=parseInt(e.attribs.points),s=[];for(let t of e.children)if(t instanceof D.W_&&"option"===t.tagName){let e=t.attribs.title,n=t.attribs.description,i=t.attribs.key,r=parseInt(t.attribs.min),o=parseInt(t.attribs.max),a=t.attribs.graphic;if(e&&n&&i&&void 0!==r&&void 0!==o)s.push({title:e,description:n,key:i,min:r,max:o,graphic:a});else throw"PointsAllocationInput Option without title, description, key, min, or max"}return(0,f.jsx)(eI,{qids:n,question:i,points:r,options:s,onAnswer:t.onAnswer})},to=(e,t)=>{console.debug("Enriching MultiSliderInput tag as MultiSliderInput...",e);let n=e0(t,e),i=e1(e),r=parseInt(e.attribs.min),s=parseInt(e.attribs.max),o=[],a=[],l=(0,E.gx)(e.attribs.showdescriptions);for(let t of e.children)if(t instanceof D.W_&&"label"===t.tagName){let e=parseFloat(t.attribs.at),n=t.attribs.text;void 0!==e&&n&&o.push({at:e,text:n})}else if(t instanceof D.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.title,i=t.attribs.description;e&&n&&a.push({key:e,title:n,description:i})}return(0,f.jsx)(eE,{qids:n,question:i,min:r,max:s,labels:o,options:a,showDescriptions:l,role:t.role,onAnswer:t.onAnswer})},ta=(e,t)=>{console.debug("Enriching AcknowledgementInput tag as AcknowledgementInput...",e);let n=e0(t,e),i=e1(e),r=e.attribs.align,s=[];for(let t of e.children)if(t instanceof D.W_&&"option"===t.tagName){let e=t.attribs.text,n=t.attribs.key,i=t.attribs.variant,r=t.attribs.colour;e&&n&&s.push({text:e,key:n,variant:i,colour:r})}return(0,f.jsx)(eT,{qids:n,question:i,options:s,align:r,onAnswer:t.onAnswer})},tl=(e,t)=>{console.debug("Enriching RankedListInput tag as RankedListInput...",e);let n=e0(t,e),i=e1(e),r=[],s=0;for(let t of e.children)if(t instanceof D.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.title,i=t.attribs.description;n&&r.push({key:e,title:n,description:i,startingIndex:s++})}return(0,f.jsx)(eW,{qids:n,question:i,options:r,onAnswer:t.onAnswer})},tc=(e,t)=>{console.debug("Enriching TopOptions tag as TopOptionsSummary...",e);let n=e0(t,e),i=e1(e),r=parseInt(e.attribs.count),s=[];for(let t of e.children)if(t instanceof D.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.title,i=t.attribs.description,r=t.attribs.graphic;e&&n&&i&&s.push({key:e,title:n,description:i,graphic:r})}return(0,f.jsx)(e_,{qids:n,question:i,options:s,displayCount:r})},td=(e,t)=>{console.debug("Enriching OrderedList tag as OrderedListDisplay...",e);let n=e0(t,e),i=e1(e),r=e.attribs.startcolour,s=e.attribs.endcolour,o=e.attribs.mode,a=[];for(let t of e.children)if(t instanceof D.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.title,i=t.attribs.description;if(e&&n)a.push({key:e,title:n,description:i});else throw console.warn("OrderedList option without key or title",t),"OrderedList option without key or title"}return(0,f.jsx)(eG,{qids:n,question:i,options:a,role:t.role,startColour:r,endColour:s,mode:o})},tu=(e,t)=>{console.debug("Enriching ImageSlide tag as ImageSlide...",e);let n=e.attribs.src,i=(0,Y.Cc)(e.attribs.style);return(0,f.jsx)(O,{style:i,src:n})},th=(e,t)=>{let n=eX(e,t);console.debug("Enriching InputOrCompletion tag as InputOrCompletion (with children)...",n);let i=e0(t,e);return(0,f.jsx)(G,{qids:i,input:n[0],completion:n[1]})},tp=(e,t)=>{let n=eX(e,t);console.debug("Enriching InputSequence tag as InputSequence (with children)...",n);let i=[];for(let e=0;e<n.length-1;e++)i.push(n[e]);let r=n[n.length-1],s=e1(e),o=(0,E.gx)(e.attribs.showprogress),a=e$(e,t);return(0,f.jsx)(em,{question:s,showProgress:o,qids:a,inputs:i,completion:r,role:t.role})},tg=(e,t)=>{console.debug("Enriching SideBarLayout tag as SideBarLayout (with children)...",e);let n=eX(e,t),i=(0,Y.if)(e.attribs.sidestyle),r=(0,Y.if)(e.attribs.mainstyle),s=e.attribs.sidebackgroundimage,o=e.attribs.mainbackgroundimage;return(0,f.jsx)(z,{side:n[0],sideSx:i,main:n[1],mainSx:r,sideBackgroundImage:s,mainBackgroundImage:o,contentStore:t.contentStore})},tf=(e,t)=>{console.debug("Enriching FullPageScrollingLayout tag as FullPageScrollingLayout (with children)...",e);let n=(0,Y.if)(e.attribs.sx),i=eX(e,t);return(0,f.jsx)(J,{sx:n,children:i})},tx=(e,t)=>{console.debug("Enriching FullPageCentredLayout tag as FullPageCentredLayout (with children)...",e);let n=(0,Y.if)(e.attribs.sx),i=eX(e,t);return(0,f.jsx)(et,{sx:n,children:i})},tm=(e,t)=>{console.debug("Enriching ColumnLayout tag as ColumnLayout (with children)...",e);let n=(0,Y.if)(e.attribs.sx),i=eX(e,t);return(0,f.jsx)(eK,{sx:n,children:i})},ty=(e,t)=>{console.debug("Enriching SlideBackgroundImage tag as SlideBackgroundImage (with children)...",e);let n=eX(e,t),i=e.attribs.src,r=(0,Y.if)(e.attribs.sx);return(0,f.jsx)(Q,{src:i,sx:r,children:n})},tv=(e,t)=>{console.debug("Enriching Completion tag as CompletionDisplay (with children)...",e);let n=e.attribs.message,i=e.attribs.factoid,r=(0,Y.if)(e.attribs.sx);return(0,f.jsx)(H,{content:{message:n,factoid:i},sx:r})},tb=(e,t)=>{console.debug("Enriching SectionHeading tag as SectionHeading...",e);let n=(0,eJ.Z)(),i=e1(e),r=[];for(let t of e.children)if(t instanceof D.W_&&"heading"===t.tagName){let e=t.attribs.title,n=t.attribs.description,i=t.attribs.graphic,s=(0,E.gx)(t.attribs.expanded);if(e)r.push({title:e,description:n,graphic:i,expanded:s});else throw console.warn("SectionHeading without title",t),"SectionHeading without title"}return(0,f.jsx)(eH,{question:i,headings:r,uid:n})},tw=(e,t)=>{console.debug("Enriching SlideText tag as SlideText (with children)...",e);let n=eX(e,t),i=(0,Y.if)(e.attribs.sx),r=e.attribs.color,s=e.attribs.align,o=e.attribs.variant;return(0,f.jsx)(K,{variant:o,sx:i,color:r,align:s,children:n})},tj=(e,t)=>{console.debug("Enriching ImageSlide tag as ImageSlide...",e);let n=e.attribs.src,i=(0,Y.Cc)(e.attribs.style);return(0,f.jsx)(X,{src:n,style:i})};(l=g||(g={}))[l.Init=0]="Init",l[l.RetrievingRawSlides=1]="RetrievingRawSlides",l[l.RawSlidesError=2]="RawSlidesError",l[l.EnrichingSlides=3]="EnrichingSlides",l[l.EnrichmentError=4]="EnrichmentError",l[l.InflatingSlides=5]="InflatingSlides",l[l.InflationError=6]="InflationError",l[l.Ready=7]="Ready";let tk=[0,1],tS=[2,4,6],tZ=[3,5],tC=(0,x.createContext)({});function tD(e){let t=(0,x.useContext)(m.A),n=(0,x.useContext)(y.rZ),i=(0,x.useContext)(v.H),[r,s]=(0,x.useState)(0),[o,a]=(0,x.useState)([]),[l,c]=(0,x.useState)([]),[d,u]=(0,x.useState)(void 0),[h,p]=(0,x.useState)(!0),[b,w]=(0,x.useState)(!1),[k,S]=(0,x.useState)(!1);(0,x.useEffect)(()=>{switch(console.debug("Static content state",g[r]),r){case 0:s(1);break;case 1:I().then(e=>{a(e),s(3)}).catch(e=>{console.error(e),s(2)});break;case 3:A().then(e=>{c(e),s(5)}).catch(e=>{console.error(e),s(4)});break;case 5:q().then(e=>{u(e),s(7)}).catch(e=>{console.error(e),s(6)})}p(void 0!==tk.find(e=>e===r)),w(void 0!==tZ.find(e=>e===r)),S(void 0!==tS.find(e=>e===r))},[r]);let I=async()=>{let e=[];for(let r of i.session.sessionPresentationUris||[]){if(!r)throw"Presentation link empty in session data.";let s=new j(t,i.session,n.sessionToken,r,!0);await s.init();let o=r.split("/").pop(),a=await s.getAsEntry(o,void 0),l=await a.content.text();if(!l)throw"No content found in presentation file.";e.push(l)}return e},E=e=>{C.Z.emit({type:C.z.Content_Progress_Update,data:e})},A=async()=>{let r=[];for(let s=0;s<o.length;s++){let a=i.session.sessionPresentationUris[s],l=o[s];if(!a)throw"Presentation link empty in session data.";let c=new j(t,i.session,n.sessionToken,a,e.refresh);await c.init();let d=new Z(l,c,E),u=d.findAllReplacements(void 0,[]);console.debug("".concat(u.length," unique resources to replace"),u);let h=await d.replaceAllReplacements(u),p=d.getAsSectionTags(h,s);if(!p)throw"No sections found in presentation.";r.push(p)}return r},q=async()=>{let r=[];for(let s=0;s<l.length;s++){let o=i.session.sessionPresentationUris[s],a=l[s];if(!o)throw"Presentation link empty in session data.";if(!a)throw"No content found in presentation xml.";let c=new j(t,i.session,n.sessionToken,o,e.refresh);await c.init();let d={sessionId:i.session.id,deviceId:n.deviceId,role:n.role,remoteMedia:i.session.remoteConfiguration!==T.VS.InPerson,remoteCall:i.session.remoteConfiguration===T.VS.RemoteWithVideoCall,keyPrefix:"module-".concat(s),contentStore:c,onAnswer:P},u=(0,D.ZP)(a,eY(d)),h=(u instanceof Array?u:[u]).map((e,t)=>(0,Y.te)(e,"module-".concat(s))).filter(e=>void 0!==e);r.push(...h)}return r},P=async i=>await t.postDeliberationAnswer(e.sid,i,n.sessionToken);return(0,f.jsxs)(f.Fragment,{children:[h&&e.initialising,b&&e.loading,k&&e.error,7===r&&(0,f.jsx)(tC.Provider,{value:{sid:e.sid,presentationXml:l,sourceXml:o,slides:d},children:e.children})]})}},37570:function(e,t,n){"use strict";n.d(t,{H:function(){return g},Z:function(){return f}});var i,r,s=n(57437),o=n(2265),a=n(58253),l=n(5085),c=n(20909),d=n(94547);(i=r||(r={}))[i.Init=0]="Init",i[i.RetrievingSession=1]="RetrievingSession",i[i.RetrievingGraphic=2]="RetrievingGraphic",i[i.SessionError=3]="SessionError",i[i.Ready=4]="Ready";let u=[3],h=[0],p=[1,2],g=(0,o.createContext)({});function f(e){let t=(0,o.useContext)(a.A),n=(0,o.useContext)(l.rZ),[i,f]=(0,o.useState)(0),[x,m]=(0,o.useState)(),[y,v]=(0,o.useState)(),[b,w]=(0,o.useState)(!0),[j,k]=(0,o.useState)(!1),[S,Z]=(0,o.useState)(!1);(0,o.useEffect)(()=>{switch(console.debug("Static data state",r[i]),i){case 0:f(1);break;case 1:C().then(e=>{m(e),f(2)}).catch(e=>{console.error(e),f(3)});break;case 2:D().then(e=>{v(e),f(4)}).catch(e=>{console.error(e),f(3)})}k(void 0!==p.find(e=>e===i)),Z(void 0!==u.find(e=>e===i)),w(void 0!==h.find(e=>e===i))},[i]);let C=async()=>{var i,r;return n.role===d._b.Controller?await t.getDeliberationSessionAdmin(e.sid,null===(i=n.user)||void 0===i?void 0:i.access_token):await t.getDeliberationSession(e.sid,null===(r=n.user)||void 0===r?void 0:r.access_token)},D=async()=>{let e={workshopDirectory:(0,c.X)(x.sessionPresentationUris[0])};return await t.getPublicContentAccessUrls(x.id,e)};return(0,s.jsxs)(s.Fragment,{children:[b&&e.initialising,j&&e.loading,S&&e.error,4===i&&(0,s.jsx)(g.Provider,{value:{sid:x.id,session:x,graphic:y},children:e.children})]})}},64463:function(e,t,n){"use strict";n.d(t,{Z:function(){return f}});var i=n(57437),r=n(44228),s=n(42748),o=n(11656),a=n(47905),l=n(86917),c=n(14595),d=n(31193),u=n(60335),h=n(21395),p=n(24072),g=n(76396);function f(e){let t=t=>{e.onVideoPreferenceChange(e.videoEnabled,t)},n=t=>{e.onAudioPreferenceChange(e.audioEnabled,t)},f=()=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(s.Z,{children:[(0,i.jsx)(o.Z,{children:(0,i.jsx)(a.Z,{inset:!0,children:(0,i.jsx)("b",{children:"Video camera inputs"})})},"video-heading"),e.videoDevices.map(n=>{var s;let c=(null===(s=e.videoDevice)||void 0===s?void 0:s.deviceId)===(null==n?void 0:n.deviceId);return(0,i.jsxs)(o.Z,{onClick:()=>t(n),children:[c&&(0,i.jsx)(l.Z,{children:(0,i.jsx)(r.Z,{})}),(0,i.jsx)(a.Z,{inset:!c,children:n.label})]},"menu-item-select-".concat(n.deviceId))})]}),(0,i.jsx)(c.Z,{}),(0,i.jsxs)(s.Z,{children:[(0,i.jsx)(o.Z,{children:(0,i.jsx)(a.Z,{inset:!0,children:(0,i.jsx)("b",{children:"Microphone inputs"})})},"audio-heading"),e.audioDevices.map(t=>{var s;let c=(null===(s=e.audioDevice)||void 0===s?void 0:s.deviceId)===(null==t?void 0:t.deviceId);return(0,i.jsxs)(o.Z,{onClick:()=>n(t),children:[c&&(0,i.jsx)(l.Z,{children:(0,i.jsx)(r.Z,{})}),(0,i.jsx)(a.Z,{inset:!c,children:t.label})]},"menu-item-select-".concat(t.deviceId))})]})]});return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(d.Z,{display:"flex",flexDirection:e.direction,justifyContent:"center",children:[(0,i.jsx)(u.Z,{disabled:e.busy,"aria-label":e.audioEnabled?"mute microphone":"enable microphone",onClick:()=>{e.onAudioPreferenceChange(!e.audioEnabled,e.audioDevice)},children:(0,i.jsx)("img",{src:e.audioEnabled?"/icons/av/mic-enabled.svg":"/icons/av/mic-disabled.svg"})}),(0,i.jsx)(u.Z,{disabled:e.busy,"aria-label":e.videoEnabled?"disable camera":"enable camera",onClick:()=>{e.onVideoPreferenceChange(!e.videoEnabled,e.videoDevice)},children:(0,i.jsx)("img",{src:e.videoEnabled?"/icons/av/cam-enabled.svg":"/icons/av/cam-disabled.svg"})}),(0,i.jsx)(p.ZP,{variant:"popover",popupId:"audio-popup",children:t=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u.Z,{disabled:e.busy,"aria-label":"settings",...(0,g.vW)(t),children:(0,i.jsx)("img",{src:"/icons/av/cog-enabled.svg"})}),(0,i.jsx)(h.Z,{...(0,g.wK)(t),children:(0,i.jsx)(f,{})})]})})]})})}},31164:function(e,t,n){"use strict";n.d(t,{Z:function(){return b}});var i,r,s=n(57437),o=n(2265),a=n(94547),l=n(8963),c=n(6722),d=n(11707),u=n(76548),h=n(31193),p=n(40468),g=n(58433);n(84075);var f=e=>{let{tileId:t}=(0,c.tt7)(),{tiles:n}=(0,c.akC)(),{tileId:i}=(0,c.EJc)(),{isVideoEnabled:r}=(0,c.Onx)(),o="featured"===e.layout&&!!t||!!i,a=n.length+(i?1:0),l=a>1&&r?a+1:a;return(0,s.jsxs)(c.P2B,{size:l,layout:o?"featured":null,style:e.gridStyle,children:[(0,s.jsx)(c.Fxf,{css:"grid-area: ft;"}),"featured"===e.layout?(0,s.jsx)(c.mXs,{}):(0,s.jsx)(c.P$F,{}),(0,s.jsx)(c.OuP,{nameplate:"Me",css:l>1?"\n  height: 100%;\n  width: 100%;\n":"\n  display: flex;\n  position: absolute;\n  bottom: 1rem;\n  right: 1rem;\n  width: 20vw;\n  max-height: 30vh;\n  height: auto;\n\n  video {\n    position: static;\n  }\n"}),0===a&&e.noRemoteVideoView]})},x=n(70883),m=n(58253);(i=r||(r={}))[i.Init=0]="Init",i[i.FetchingAttendeeData=1]="FetchingAttendeeData",i[i.AttendeeDataRetrieved=2]="AttendeeDataRetrieved",i[i.AttendeeDataError=3]="AttendeeDataError",i[i.MeetingConnecting=4]="MeetingConnecting",i[i.MeetingConnected=5]="MeetingConnected",i[i.MeetingStarting=6]="MeetingStarting",i[i.MeetingStarted=7]="MeetingStarted",i[i.MeetingLeft=8]="MeetingLeft",i[i.MeetingUnavailable=9]="MeetingUnavailable",i[i.ChimeError=10]="ChimeError",i[i.ConnectedOnAnotherDevice=11]="ConnectedOnAnotherDevice";let y={unexpected:!1,anotherDevice:!1,unavailable:!1,left:!1},v={deviceLabels:c.C$T.AudioAndVideo};function b(e){let[t,n]=(0,o.useState)(0),[i,b]=(0,o.useState)(),[w,j]=(0,o.useState)(),[k,S]=(0,o.useState)(),[Z,C]=(0,o.useState)(y),D=(0,c.fjl)();(0,c.tt7)();let{tileId:I,isVideoEnabled:E,hasReachedVideoLimit:A,toggleVideo:q}=(0,c.Onx)(),P=(0,c.HI)(),_=(0,c.ULf)(),T=(0,c.QvM)(),R=(0,o.useContext)(m.A),F=(0,o.useContext)(x.l),[N,U]=(0,o.useState)(F.subscriptions);(0,o.useEffect)(()=>{U(F.subscriptions)},[F]),(0,o.useEffect)(()=>{var t,n;console.debug("initial call prefrerences",e.initialCallPreferences),(null===(t=e.initialCallPreferences)||void 0===t?void 0:t.videoDevice)!==void 0&&D.startVideoInputDevice(e.initialCallPreferences.videoDevice.deviceId),(null===(n=e.initialCallPreferences)||void 0===n?void 0:n.audioDevice)!==void 0&&D.startAudioInputDevice(e.initialCallPreferences.audioDevice.deviceId)},[]);let B=(0,o.useMemo)(()=>async(e,t)=>{void 0===t&&console.warn("Undefined pid passed from chime.");var n,i=N.find(e=>e.deviceId===t);return void 0===i&&console.warn("No subscription found for pid: ".concat(t),N),{name:null!==(n=null==i?void 0:i.participantName)&&void 0!==n?n:"Unknown"}},[N]);(0,o.useEffect)(()=>{D.getAttendee=B,D.updateDeviceLists()},[N]),(0,o.useEffect)(()=>(D.subscribeToMeetingStatus(W),()=>{console.log("Unmounting ZeitgeistMeeting..."),D.getAttendee=void 0,D.leave(),D.unsubscribeFromMeetingStatus(W)}),[]);let W=e=>{console.debug("Meeting status change detected: ".concat(c.ytK[e])),S(e)},V=e.role===a._b.Controller||e.facilitationState===a._y.Open;(0,o.useEffect)(()=>{console.debug("Facilitation state changed to: ".concat(a._y[e.facilitationState])),V&&0!==t&&1!==t&&n(1),V||(console.debug("disconnecting..."),j(null))},[e.facilitationState]),(0,o.useEffect)(()=>{switch(console.debug("ZeitgeistMeeting view state: ".concat(r[t])),t){case 0:V&&n(1);break;case 1:C(y),M().then(e=>{(null==e?void 0:e.chimeMeetingId)!==(null==i?void 0:i.chimeMeetingId)&&b(e),e?n(2):n(3)}).catch(e=>{console.error(e)});break;case 2:C(y),n(4);break;case 3:case 10:C({...y,unexpected:!0});break;case 4:C(y);let s=L();(null==w?void 0:w.meetingId)!==s.meetingId||k!==c.ytK.Succeeded?j(s):n(5);break;case 5:C(y),n(6);break;case 6:C(y),O();break;case 7:C(y);break;case 9:e.role===a._b.Controller?(C(y),n(1)):C({...y,unavailable:!0});break;case 8:C({...y,left:!0});break;case 11:C({...y,anotherDevice:!0})}},[t,e.facilitationState]);let M=async()=>{var t;let n=await R.retrieveMeetingAttendeeData(e.sid,e.sessionToken,e.participantId,null!==(t=e.participantName)&&void 0!==t?t:"unknown",e.accessToken);return console.debug("Retrieved attendee data",n),n},L=()=>new l.MeetingSessionConfiguration({MeetingId:i.chimeMeetingId,MediaPlacement:{AudioHostUrl:i.audioHostUrl,SignalingUrl:i.signalingUrl,TurnControlUrl:i.turnControlUrl,AudioFallbackUrl:i.audioFallbackUrl,EventIngestionUrl:i.eventIngestionUrl,ScreenDataUrl:i.screenDataUrl,ScreenViewingUrl:i.screenViewingUrl}},{ExternalUserId:i.chimeAttendeeExternalId,AttendeeId:i.chimeAttendeeId,JoinToken:i.chimeJoinToken});(0,o.useEffect)(()=>{console.debug("Config change"),null!=w?D.join(w,v).then(()=>{n(5)}):D.leave()},[w]),(0,o.useEffect)(()=>{switch(console.debug("Acting on meeting status: ".concat(void 0!==k?c.ytK[k]:"undefined")),k){case c.ytK.Loading:break;case c.ytK.Succeeded:n(7);break;case c.ytK.Reconnecting:n(4);break;case c.ytK.Left:n(8);break;case c.ytK.Failed:n(10);break;case c.ytK.Ended:n(9);break;case c.ytK.TerminalFailure:n(10);break;case c.ytK.JoinedFromAnotherDevice:n(11)}},[k]);let O=async()=>{console.debug("Starting the meeting from state: ".concat(void 0!==k?c.ytK[k]:"undefined"));try{await D.start(),n(7)}catch(e){console.error(e),n(10)}},z=async()=>{try{if(void 0!==_.selectedDevice&&T.isBackgroundBlurSupported){let e=await T.createBackgroundBlurDevice(_.selectedDevice);await D.startVideoInputDevice(e)}else console.warn("No video input device found to enable Background Blur.")}catch(e){console.error("Failed to enable Background Blur",e)}};(0,o.useEffect)(()=>{k===c.ytK.Succeeded&&(console.debug("Configuring meeting with initial prefererences",e.initialCallPreferences),e.initialCallPreferences?(e.initialCallPreferences.videoEnabled!==E&&q(),e.initialCallPreferences.audioEnabled===P.muted&&P.toggleMute(),e.initialCallPreferences.blurBackground&&z()):E||q())},[k]);let G=e.role===a._b.Controller?"vertical":"horizontal";return e.role,a._b.Client,(0,s.jsxs)(s.Fragment,{children:[Z.unexpected&&(0,s.jsx)("p",{children:"An unexpected error prevented us from connecting you to the video call. Please refresh the page."}),Z.anotherDevice&&(0,s.jsx)("p",{children:"You are already connected in another tab. Please close any other browser tabs connected to this workshop."}),Z.unavailable&&(0,s.jsx)("p",{children:"The video call is not available at this time. Please try again later."}),Z.left&&(0,s.jsx)("p",{children:"You have left the video call."}),11===t&&(0,s.jsx)(u.Z,{variant:"outlined",onClick:()=>n(1),children:"Try again"}),3===t&&(0,s.jsx)(u.Z,{variant:"outlined",onClick:()=>n(1),children:"Try again"}),9===t&&(0,s.jsx)(u.Z,{variant:"outlined",onClick:()=>n(1),children:"Try again"}),8===t&&(0,s.jsx)(u.Z,{variant:"outlined",onClick:()=>n(1),children:"Rejoin"}),10===t&&(0,s.jsx)(u.Z,{variant:"outlined",onClick:()=>n(4),children:"Try again"}),0>[7,8,9,10,11].indexOf(t)&&(0,s.jsx)(h.Z,{display:"flex",flexGrow:1,justifyContent:"center",alignItems:"center",children:(0,s.jsx)(p.Z,{})}),k===c.ytK.Succeeded&&(0,s.jsx)(g.ZP,{container:!0,style:{flexGrow:1},children:(0,s.jsx)(g.ZP,{item:!0,xs:12,display:"flex",flexDirection:"horizontal"===G?"column":"row",children:(0,s.jsx)(d.f6,{theme:c.Wbj,children:(0,s.jsx)(f,{layout:"standard",noRemoteVideoView:(0,s.jsx)(s.Fragment,{}),gridStyle:{gap:"0.5rem"}})})})})]})}},79044:function(e,t,n){"use strict";n.d(t,{K:function(){return m},Z:function(){return y}});var i,r,s=n(57437),o=n(2265),a=n(24314),l=n(31193),c=n(80511),d=n(66858),u=n(42410);function h(e){let[t,n]=(0,o.useState)(""),[i,r]=(0,o.useState)(!1),a=i&&0===t.trim().length,h=!a&&t.trim().length>0,p=()=>{h&&e.submitName(t)};return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(l.Z,{children:[(0,s.jsx)(c.Z,{variant:"h4",children:"How should we refer to you?"}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),p()},children:[(0,s.jsx)(d.Z,{sx:{mb:4,input:{background:"white"}},fullWidth:!0,style:{flexGrow:1},label:"Please enter your name...",variant:"outlined",value:t,helperText:"Your name is purely for use within the session. It will not be saved or stored.",onChange:e=>{n(e.target.value),r(!0)},error:a,color:"buttonStandard"}),(0,s.jsx)(u.Z,{inline:!1,alignment:"left",busy:!1,enabled:h,onSubmit:p,text:"CONTINUE"})]})]})})}var p=n(34360),g=n(37570),f=n(43655),x=n(43312);(i=r||(r={}))[i.InputName=0]="InputName",i[i.Ready=1]="Ready";let m=(0,o.createContext)({});function y(e){let t=(0,o.useContext)(g.H),[n,i]=(0,o.useState)(0),[r,l]=(0,o.useState)(),c=(0,o.useMemo)(()=>(0,s.jsx)(p.Z,{url:t.graphic.posterUrl}),[t.graphic.posterUrl]),d=(0,o.useCallback)(e=>{l(e),i(1)},[l,i]);return(0,s.jsxs)(s.Fragment,{children:[1!==n&&(0,s.jsx)(f.Z,{heading:(0,s.jsx)(x.Z,{session:t.session,layout:"heading",welcome:!0}),main:(0,s.jsx)(s.Fragment,{children:0===n&&(0,s.jsx)(a.Z,{left:(0,s.jsx)(h,{submitName:d}),right:c})})}),1===n&&(0,s.jsx)(m.Provider,{value:{participantName:r},children:e.children})]})}},68276:function(e,t,n){"use strict";n.d(t,{u:function(){return S},Z:function(){return Z}});var i,r,s=n(57437),o=n(2265),a=n(60182),l=n(94547),c=n(31193),d=n(76548),u=n(6820),h=n.n(u),p=n(64463);let g={videoEnabled:!0,audioEnabled:!0,videoDevice:void 0,audioDevice:void 0,blurBackground:!1};function f(e){let[t,n]=o.useState([]),[i,r]=o.useState([]),[a,l]=o.useState(void 0),[u,g]=o.useState(void 0),[f,x]=o.useState(!0),[m,y]=o.useState(!0);(0,o.useEffect)(()=>{void 0!==navigator&&navigator.mediaDevices.enumerateDevices().then(e=>{n(v(e)),r(b(e))})},[]),(0,o.useEffect)(()=>{e.onPreferences({videoEnabled:f,audioEnabled:m,videoDevice:a,audioDevice:u,blurBackground:!1})},[f,m,a,u]);let v=e=>e.filter(e=>{let{kind:t}=e;return"videoinput"===t}),b=e=>e.filter(e=>{let{kind:t}=e;return"audioinput"===t}),w={maxWidth:"100%",maxHeight:"100%",width:"auto"},j={height:320,facingMode:a?void 0:"user",deviceId:null==a?void 0:a.deviceId};return(0,s.jsxs)(c.Z,{display:"flex",flexDirection:"column",flexGrow:1,children:[(0,s.jsx)(()=>(0,s.jsx)(c.Z,{sx:{borderRadius:2,p:1,mb:2,background:"#d9d9d9",display:"flex",flexDirection:"column",alignItems:"center",justifyItems:"stretch"},children:(0,s.jsx)("div",{style:{...w},children:f&&(0,s.jsx)(h(),{mirrored:!0,style:w,videoConstraints:j})})}),{}),(0,s.jsx)(()=>(0,s.jsxs)(c.Z,{display:"flex",flexDirection:"row",justifyContent:"center",gap:2,children:[(0,s.jsx)(p.Z,{direction:"row",videoEnabled:f,audioEnabled:m,videoDevices:t,audioDevices:i,videoDevice:a,audioDevice:u,onVideoPreferenceChange:async(e,t)=>{x(e),l(t)},onAudioPreferenceChange:async(e,t)=>{y(e),g(t)},busy:!1}),e.showJoin&&(0,s.jsx)(d.Z,{variant:"contained",size:"large",sx:{alignSelf:"center"},onClick:e.onJoin,children:"JOIN"}),e.showLeave&&(0,s.jsx)(d.Z,{variant:"outlined",size:"large",sx:{alignSelf:"center"},onClick:e.onLeave,children:"LEAVE"})]}),{})]})}var x=n(27270),m=n(5085),y=n(37570),v=n(24314),b=n(34360),w=n(43655),j=n(43312),k=n(79044);(i=r||(r={}))[i.Init=0]="Init",i[i.PreviewMedia=1]="PreviewMedia",i[i.NoPreview=2]="NoPreview";let S=(0,o.createContext)({});function Z(e){let t=(0,o.useContext)(y.H),n=(0,o.useContext)(a.d),i=(0,o.useContext)(k.K),d=(0,o.useContext)(m.rZ),[u,h]=(0,o.useState)(0),[p,Z]=(0,o.useState)(!1),[C,D]=(0,o.useState)(g),[I,E]=(0,o.useState)(!1);(0,o.useEffect)(()=>{switch(console.debug("Media preview state",r[u]),u){case 0:h(t.session.remoteConfiguration===l.VS.RemoteWithVideoCall?1:2);break;case 2:Z(!0)}},[u]),(0,o.useEffect)(()=>{E((2===u||1===u)&&(n.facilitationState===l._y.Open||d.role===l._b.Controller)&&p)},[p,u,n.facilitationState]);let A=n.facilitationState===l._y.Ready,q=n.facilitationState===l._y.Closed,P=(0,o.useMemo)(()=>(0,s.jsx)(b.Z,{url:t.graphic.posterUrl}),[t.graphic.posterUrl]);return(0,s.jsxs)(s.Fragment,{children:[!I&&(0,s.jsxs)(s.Fragment,{children:[1===u&&(0,s.jsx)(w.Z,{heading:(0,s.jsx)(j.Z,{session:t.session,layout:"heading",welcome:!0}),main:(0,s.jsx)(v.Z,{left:(0,s.jsxs)(c.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[!p&&d.role!==l._b.Controller&&(0,s.jsxs)(x.Z,{severity:"info",children:["Please check your settings and press the ",(0,s.jsx)("b",{children:"join"})," button when ready."]}),p&&(0,s.jsx)(x.Z,{severity:"success",children:"Please wait for the workshop to open."}),!A&&!q&&(0,s.jsx)(x.Z,{severity:"success",children:"The workshop has started."}),d.role!==l._b.Controller&&A&&!q&&(0,s.jsx)(x.Z,{severity:"info",children:"The workshop will begin soon..."}),d.role===l._b.Controller&&(0,s.jsx)(x.Z,{severity:"info",children:"You are the facilitator. The session will begin once you open it."}),q&&(0,s.jsx)(x.Z,{severity:"warning",children:"The workshop has closed."}),!q&&(0,s.jsx)(f,{name:i.participantName,session:t.session,showJoin:!p,showLeave:p,onJoin:()=>{Z(!0)},onLeave:()=>{Z(!1)},onPreferences:D})]}),right:P})}),2===u&&(0,s.jsx)(w.Z,{heading:(0,s.jsx)(j.Z,{session:t.session,layout:"heading",welcome:!0}),main:(0,s.jsx)(v.Z,{left:(0,s.jsxs)(s.Fragment,{children:[A&&(0,s.jsx)(x.Z,{severity:"success",children:"Please wait, the session will begin soon..."}),q&&(0,s.jsx)(x.Z,{severity:"info",children:"The session has ended. Thank you for participating!"})]}),right:P})})]}),I&&(0,s.jsx)(S.Provider,{value:{call:C},children:e.children})]})}},43312:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=n(57437),r=n(31193),s=n(80511),o=n(76548);function a(e){return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(r.Z,{sx:{mb:2},children:[e.welcome&&(0,i.jsx)(s.Z,{variant:"body1",children:"WELCOME TO"}),(0,i.jsx)(s.Z,{variant:"h3",component:"h2",children:e.session.sessionName})]}),(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"column"===e.layout?"column":"row"},gap:2,children:[(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"column"===e.layout?"start":"center",gap:1},children:[(0,i.jsx)("img",{src:"/icons/session-date.svg"}),(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"column"===e.layout?"column":"row",alignItems:"column"===e.layout?"flex-start":"center",gap:1},children:[(0,i.jsx)(s.Z,{variant:"body2",children:"DATE"}),(0,i.jsx)(s.Z,{variant:"body1",style:{fontWeight:"bold"},children:new Date(e.session.sessionStartTime).toDateString()})]})]}),(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"column"===e.layout?"start":"center",gap:1},children:[(0,i.jsx)("img",{src:"/icons/session-time.svg"}),(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"column"===e.layout?"column":"row",alignItems:"column"===e.layout?"flex-start":"center",gap:1},children:[(0,i.jsx)(s.Z,{variant:"body2",children:"TIME"}),(0,i.jsx)(s.Z,{variant:"body1",style:{fontWeight:"bold"},children:new Date(e.session.sessionStartTime).toLocaleTimeString()})]})]})]}),void 0!==e.onAdvance&&(0,i.jsx)(o.Z,{variant:"contained",color:"primary",onClick:e.onAdvance,sx:{alignSelf:"start"},children:"Next"})]})}},34360:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=n(57437),r=n(31193),s=n(48474),o=n(2265);function a(e){var t;let[n,a]=(0,s.q_)(()=>({opacity:0}));return(0,o.useEffect)(()=>{void 0!==e.url&&a.start({to:{opacity:1},config:{duration:2e3}})},[e.url]),(0,i.jsx)(r.Z,{justifySelf:"stretch",flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",sx:{borderRadius:2},children:(0,i.jsx)(s.q.img,{src:e.url,alt:null!==(t=e.alt)&&void 0!==t?t:"Session graphic",style:{minWidth:"100%",minHeight:"100%",flexShrink:0,...e.style,...n}})})}},43655:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var i=n(57437),r=n(31193),s=n(97340);function o(e){return(0,i.jsxs)(r.Z,{display:"flex",flexDirection:"column",flexGrow:1,children:[(0,i.jsx)(r.Z,{display:"flex",flexDirection:"column",sx:{p:2},children:e.heading}),(0,i.jsx)(r.Z,{display:"flex",flexDirection:"column",flexGrow:1,children:(0,i.jsx)(s.Z,{sx:{flexGrow:1,m:1},children:e.main})})]})}},24314:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var i=n(57437),r=n(58433),s=n(31193);function o(e){let{left:t,right:n}=e;return(0,i.jsxs)(r.ZP,{container:!0,flexGrow:1,children:[(0,i.jsx)(r.ZP,{item:!0,xs:12,md:6,flexGrow:1,display:"flex",flexDirection:"column",children:(0,i.jsx)(s.Z,{display:"flex",flexDirection:"column",gap:1,sx:{overflowY:"auto",flexGrow:{xs:void 0,md:1}},children:t})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,md:6,flexGrow:1,display:"flex",flexDirection:"column",children:(0,i.jsx)(s.Z,{display:"flex",flexDirection:"column",gap:1,sx:{pl:{xs:void 0,md:2},overflowY:"auto",flexGrow:{xs:void 0,md:1}},children:n})})]})}},82297:function(e,t,n){"use strict";n.d(t,{Z:function(){return eo}});var i,r,s,o,a,l,c=n(57437),d=n(58253),u=n(37570),h=n(2265);function p(){let e=(0,h.useContext)(u.H);return(0,h.useEffect)(()=>{document.title=e.session.sessionName},[]),(0,c.jsx)(c.Fragment,{})}function g(){let e=[/defaultProps/,/of chart should be greater than 0/,/It will be ignored./,/If you accidentally passed it from a parent component, remove it from the DOM element./,/Form submission canceled because the form is not connected/,/Violation/,/Enriching/];return(0,h.useEffect)(()=>{let t=console.error,n=console.warn,i=console.debug;return console.error=function(){for(var n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];"string"==typeof i[0]&&e.some(e=>e.test(i[0]))||t(...i)},console.warn=function(){for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];"string"==typeof i[0]&&e.some(e=>e.test(i[0]))||n(...i)},console.debug=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];"string"==typeof n[0]&&e.some(e=>e.test(n[0]))||i(...n)},()=>{console.error=t,console.warn=n,console.debug=i}},[]),(0,c.jsx)(c.Fragment,{})}var f=n(99128),x=n(27270),m=n(80511),y=n(76548),v=n(69540),b=n(61570),w=n(87913),j=n(8487),k=n(86514),S=n(80438),Z=n(67630),C=n(10745),D=n(44330),I=n(24309),E=n(63858);let A={checking_wake_lock:!1,checking_permissions:!1,explain_request:!1,get_request:!1,get_success:!1,get_fail_system:!1,get_fail_user:!1,get_fail_could_not_start:!1,get_fail_unknown_error:!1};function q(e){let[t,n]=(0,h.useState)({av:!1}),[i,r]=(0,h.useState)(A),[s,a]=(0,h.useState)(!1),[l,d]=(0,h.useState)(0);(0,h.useEffect)(()=>{switch(console.debug("state",o[l]),l){case 0:d(1);break;case 1:r({...A,checking_wake_lock:!0}),a(!0),g().then(()=>{d(2)});break;case 2:r({...A,checking_permissions:!0}),a(!0),u().then(e=>{e?(r({...A,get_success:!0}),d(4)):d(3)});break;case 3:r({...A,explain_request:!0}),a(!1);break;case 4:r({...A,get_request:!0}),a(!1),p().then(e=>{if(!0===e||!1===e)n({av:e}),r({...A,get_success:e,get_fail_unknown_error:!e});else{let{type:t,name:i,message:s}=e;n({av:!1}),console.error("Permission denied: ".concat(i,", ").concat(s)),r({...A,get_success:!1,get_fail_system:t===v.wS.SystemPermissionDenied,get_fail_user:t===v.wS.UserPermissionDenied,get_fail_could_not_start:t===v.wS.CouldNotStartVideoSource,get_fail_unknown_error:null==t||t===v.wS.Generic})}d(5)});break;case 5:a(!1),t.av&&e.onDone(!0)}},[l]),(0,h.useEffect)(()=>{console.info("Media permissions",t)},[t]);let u=async()=>{if(void 0===navigator)return console.warn("Navigator required to check permissions"),!1;try{let e=await navigator.permissions.query({name:"camera"});return"granted"===e.state}catch(e){return console.error("Error checking camera permissions",e),!1}},p=async()=>{try{let e=await (0,v.TD)();if(void 0!==e)return e;throw{type:v.wS.Generic,name:"Unknown",message:"Unknown error"}}catch(e){if(void 0!==e)return e;return{type:v.wS.Generic,name:"Unknown",message:"Unknown error"}}},g=async()=>{void 0!==navigator?void 0!==navigator.permissions?(console.debug("Checking screen wake-lock permission..."),console.info("screen-wake-lock permission",(await navigator.permissions.query({name:"screen-wake-lock"})).state)):console.warn("navigator.permissions is undefined"):console.warn("navigator is undefined")};return(0,c.jsxs)(c.Fragment,{children:[s&&(0,c.jsx)(f.Z,{}),i.checking_permissions&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(x.Z,{severity:"info",children:"We need permission to keep your screen on while you're in the workshop."}),(0,c.jsx)(m.Z,{variant:"h4",component:"h2",children:"Checking for permission"}),(0,c.jsx)(m.Z,{variant:"body1",children:"Please wait while we check for permission to keep your screen on while you're in the workshop..."})]}),i.checking_permissions&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(x.Z,{severity:"info",children:"We need your permission to use your camera and microphone to participate in this workshop."}),(0,c.jsx)(m.Z,{variant:"h4",component:"h2",children:"Checking for permission"}),(0,c.jsx)(m.Z,{variant:"body1",children:"Please wait while we check for permission to use your camera and microphone..."})]}),i.explain_request&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(x.Z,{severity:"info",children:"We need your permission to use your camera and microphone to participate in this workshop."}),(0,c.jsx)(m.Z,{variant:"h4",component:"h2",children:"Permission to join the video call"}),(0,c.jsx)(m.Z,{variant:"body1",children:"If prompted by your browser, please grant access to your camera and microphone."}),(0,c.jsx)(y.Z,{sx:{alignSelf:"start"},variant:"contained",color:"primary",onClick:()=>{d(4)},children:"Grant permission"})]}),i.get_request&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(x.Z,{severity:"info",children:"We need your permission to use your camera and microphone to participate in this session."}),(0,c.jsx)(m.Z,{variant:"h4",component:"h2",children:"Permission to join the video call"}),(0,c.jsx)(m.Z,{variant:"body1",children:"If prompted by your browser, please grant access to your camera and microphone."})]}),i.get_success&&(0,c.jsx)(x.Z,{severity:"success",children:"Your camera and microphone are ready to go!"}),i.get_fail_system&&(0,c.jsx)(x.Z,{severity:"error",children:"Your browser has denied access to your camera and microphone. Please check your browser settings and reload the page."}),i.get_fail_user&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(x.Z,{severity:"warning",children:"You have denied access to your camera and/or microphone."}),(0,c.jsxs)(m.Z,{variant:"h4",component:"h2",children:["What to do next on ",E.KC]}),E.i7&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(x.Z,{severity:"info",icon:(0,c.jsx)(b.Z,{fontSize:"inherit"}),children:"If you see a crossed video camera icon at the end of your address bar, click it to change permissions."}),(0,c.jsx)(x.Z,{severity:"info",icon:(0,c.jsx)(w.Z,{fontSize:"inherit"}),children:"If you don't see a camera icon, click the info icon at the beginning of the address bar for the page settings."}),(0,c.jsx)(x.Z,{severity:"info",icon:(0,c.jsx)(j.Z,{fontSize:"inherit"}),children:"Grant permission to access camera and microphone from there."}),(0,c.jsx)(x.Z,{severity:"info",icon:(0,c.jsx)(k.Z,{fontSize:"inherit"}),children:"When done, reload the page."})]}),E.vU&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(x.Z,{severity:"info",icon:(0,c.jsx)(b.Z,{fontSize:"inherit"}),children:"If you see a crossed video camera or microphone icon at the start of your address bar, click it to change permissions."}),(0,c.jsxs)(x.Z,{severity:"info",icon:(0,c.jsx)(S.Z,{fontSize:"inherit"}),children:["If you don't see those icons, choose ",(0,c.jsx)("b",{children:"Tools"})," > ",(0,c.jsx)("b",{children:"Page Info"})," from the menu."]}),(0,c.jsxs)(x.Z,{severity:"info",icon:(0,c.jsx)(j.Z,{fontSize:"inherit"}),children:["Grant permission to access camera and microphone from the ",(0,c.jsx)("b",{children:"Permissions"})," tab."]}),(0,c.jsx)(x.Z,{severity:"info",icon:(0,c.jsx)(k.Z,{fontSize:"inherit"}),children:"When done, reload the page."}),(0,c.jsx)("img",{src:"/instructions/permissions-dialog-ff.png",style:{width:"80%",alignSelf:"center"}})]}),E.G6&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(x.Z,{severity:"info",icon:(0,c.jsx)(S.Z,{fontSize:"inherit"}),children:["Choose ",(0,c.jsx)("b",{children:"Safari"})," > ",(0,c.jsx)("b",{children:"Settings"})," from the menu, then click ",(0,c.jsx)("b",{children:"Websites"}),"."]}),(0,c.jsxs)(x.Z,{severity:"info",icon:(0,c.jsx)(Z.Z,{fontSize:"inherit"}),children:["Choose the Camera settings, and set this site to ",(0,c.jsx)("b",{children:"Allow"}),"."]}),(0,c.jsxs)(x.Z,{severity:"info",icon:(0,c.jsx)(C.Z,{fontSize:"inherit"}),children:["Choose the Microphone settings, and set this site to ",(0,c.jsx)("b",{children:"Allow"}),"."]}),(0,c.jsx)(x.Z,{severity:"info",icon:(0,c.jsx)(D.Z,{fontSize:"inherit"}),children:"When done, reload the page."}),(0,c.jsx)("img",{src:"/instructions/permissions-dialog-sf.png",style:{width:"80%",alignSelf:"center"}})]}),E.un&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(x.Z,{severity:"info",icon:(0,c.jsx)(S.Z,{fontSize:"inherit"}),children:"Select Settings and more... and select Settings."}),(0,c.jsx)(x.Z,{severity:"info",icon:(0,c.jsx)(j.Z,{fontSize:"inherit"}),children:"Select Cookies and Site Permissions on the left side."}),(0,c.jsx)(x.Z,{severity:"info",icon:(0,c.jsx)(k.Z,{fontSize:"inherit"}),children:"Under Site Permissions, select Camera or Microphone."}),(0,c.jsx)(x.Z,{severity:"info",icon:(0,c.jsx)(D.Z,{fontSize:"inherit"}),children:"Grant permissions there"}),(0,c.jsx)(x.Z,{severity:"info",icon:(0,c.jsx)(I.Z,{fontSize:"inherit"}),children:"When done, reload this page."})]}),!E.i7&&!E.vU&&!E.G6&&!E.un&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(x.Z,{severity:"warning",children:["We don't have instructions for ",E.KC,"."]}),(0,c.jsx)(x.Z,{severity:"info",icon:(0,c.jsx)(S.Z,{fontSize:"inherit"}),children:"Please grant camera and microphone permissions for this page."}),(0,c.jsx)(x.Z,{severity:"info",icon:(0,c.jsx)(j.Z,{fontSize:"inherit"}),children:"When done, reload the page."})]})]}),i.get_fail_could_not_start&&(0,c.jsx)(x.Z,{severity:"warning",children:"Your camera and microphone are in use by another application. Please close the other application, refresh this page, and try again."}),i.get_fail_unknown_error&&(0,c.jsx)(x.Z,{severity:"error",children:"An unexpected error has prevented us from checking your camera and microphone. Please reload the page to try again."})]})}(i=o||(o={}))[i.Init=0]="Init",i[i.CheckingWakeLock=1]="CheckingWakeLock",i[i.CheckingPermission=2]="CheckingPermission",i[i.ExplainRequestPermissions=3]="ExplainRequestPermissions",i[i.GetPermission=4]="GetPermission",i[i.Result=5]="Result";var P=n(24314),_=n(34360),T=n(43655),R=n(43312),F=n(31193);function N(e){let[t,n]=(0,h.useState)(0),i=()=>void 0!==window&&void 0!==window.navigator&&void 0!==window.navigator.storage;(0,h.useEffect)(()=>{switch(t){case 0:i()||e.onDone(!1);break;case 1:r().then(t=>{console.debug("storage granted: ".concat(t)),e.onDone(t)})}},[t]);let r=async()=>i()&&void 0!==window.navigator.storage.persist&&await window.navigator.storage.persist();return(0,c.jsxs)(c.Fragment,{children:[0===t&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(m.Z,{variant:"h4",component:"h2",children:"Permission to store workshop content"}),(0,c.jsx)(m.Z,{variant:"body1",children:"We need your permission to store workshop content on this device. This helps save time and data if you reload the page, or restart your device."}),(0,c.jsx)(m.Z,{variant:"body1",children:"It's ok if you'd rather not grant that permission."}),(0,c.jsxs)(F.Z,{sx:{display:"flex",flexDirection:"row",gap:1},children:[(0,c.jsx)(y.Z,{sx:{alignSelf:"start"},variant:"contained",color:"primary",onClick:()=>{n(1)},children:"Grant permission"}),(0,c.jsx)(y.Z,{sx:{alignSelf:"start"},variant:"outlined",color:"primary",onClick:()=>{e.onDone(!1)},children:"No thanks"})]})]}),1===t&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(m.Z,{variant:"h4",component:"h2",children:"Permission to store workshop content"}),(0,c.jsx)(m.Z,{variant:"body1",children:"If you see a prompt from your browser, please grant permission to store data on your device."}),(0,c.jsx)(y.Z,{sx:{alignSelf:"start"},variant:"outlined",color:"primary",onClick:()=>e.onDone(!1),children:"Skip"})]})]})}(r=a||(a={}))[r.Describe=0]="Describe",r[r.Request=1]="Request";var U=n(94547),B=n(22960);function W(e){let t=(0,B.Z)(),[n,i]=(0,h.useState)([]);return(0,h.useEffect)(()=>{let t=["We'll ask you for a name, so we know how to refer to you during the workshop."];e.session.remoteConfiguration===U.VS.RemoteWithVideoCall&&t.push("We'll ask for permission to use your camera and microphone, for the video call."),t.push("We'll ask for permission to keep workshop content on your device. (This is optional.)"),t.push("We'll fetch the workshop content for today, so it's ready for when we start."),i(t)},[]),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(m.Z,{variant:"h4",children:"Thank you for joining us"}),e.session.facilitationState===U._y.Closed&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(m.Z,{variant:"h5",children:"Session closed"}),(0,c.jsx)(m.Z,{variant:"body1",children:"This session has ended. Thank you for your participation."}),(0,c.jsx)(m.Z,{variant:"body2",children:"If you believe you're seeing this message in error, please contact your facilitator for more information."})]}),e.session.facilitationState!==U._y.Closed&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(m.Z,{variant:"h5",children:"Today's session"}),(0,c.jsx)(F.Z,{sx:{border:"solid 2px",borderColor:t.palette.buttonQuiet.main,background:t.palette.buttonQuiet.main,p:2,borderRadius:2},children:(0,c.jsx)(m.Z,{variant:"body1",children:e.session.sessionDescription})}),(0,c.jsx)(m.Z,{variant:"h5",children:"Let's get started"}),(0,c.jsxs)(m.Z,{variant:"body1",component:"div",children:["In order to connect you to the workshop, we'll need a few things:",(0,c.jsx)("ul",{children:n.map((e,t)=>(0,c.jsx)("li",{children:e},"welcome-list-item-".concat(t)))})]}),(0,c.jsx)(y.Z,{sx:{alignSelf:"start"},variant:"contained",color:"primary",onClick:e.onComplete,children:"Continue"})]})]})}var V=n(5085);function M(e){let t=(0,h.useContext)(V.rZ),n=(0,h.useMemo)(()=>{var t;return(null===(t=e.elementRef)||void 0===t?void 0:t.current)||document.documentElement},[e.elementRef]),[i,r]=(0,h.useState)(),s=()=>{try{document.fullscreenEnabled?n.requestFullscreen({navigationUI:"hide"}):console.warn("Fullscreen not supported")}catch(e){console.error("Error entering fullscreen",e)}},o=()=>{try{document.exitFullscreen()}catch(e){console.error("Error exiting fullscreen",e)}};return(0,h.useEffect)(()=>{document.onfullscreenchange=e=>{document.fullscreenEnabled,r(null!==document.fullscreenElement)}},[]),(0,h.useEffect)(()=>{t.role===U._b.Client&&void 0!==n&&(e.goFullScreen&&!i&&s(),!e.goFullScreen&&i&&o())},[e.goFullScreen,n]),(0,c.jsx)(c.Fragment,{})}(s=l||(l={}))[s.Welcome=0]="Welcome",s[s.ObtainVideoPermissions=1]="ObtainVideoPermissions",s[s.ObtainStoragePermissions=2]="ObtainStoragePermissions",s[s.Ready=3]="Ready";let L=(0,h.createContext)({});function O(e){let t=(0,h.useContext)(u.H),[n,i]=(0,h.useState)(0),[r,s]=(0,h.useState)(),[o,a]=(0,h.useState)(),[l,d]=(0,h.useState)(),p=(0,h.useMemo)(()=>(0,c.jsx)(_.Z,{url:t.graphic.posterUrl}),[t.graphic.posterUrl]),g=(0,h.useCallback)(()=>{i(1),y(!0)},[i]),f=(0,h.useCallback)(e=>{a(e),i(2)},[a,i]),x=(0,h.useCallback)(e=>{d(e),i(3)},[d,i]);(0,h.useEffect)(()=>{1===n&&t.session.remoteConfiguration!==U.VS.RemoteWithVideoCall&&(a(!1),i(2))},[n]);let[m,y]=(0,h.useState)(!1);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(M,{goFullScreen:m}),3!==n&&(0,c.jsx)(T.Z,{heading:(0,c.jsx)(R.Z,{session:t.session,layout:"heading",welcome:!0}),main:(0,c.jsxs)(c.Fragment,{children:[0===n&&(0,c.jsx)(P.Z,{left:(0,c.jsx)(W,{session:t.session,onComplete:g}),right:(0,c.jsx)(_.Z,{url:t.graphic.posterUrl})}),1===n&&(0,c.jsx)(P.Z,{left:(0,c.jsx)(q,{onDone:f}),right:p}),2===n&&(0,c.jsx)(P.Z,{left:(0,c.jsx)(N,{onDone:x}),right:p})]})}),3===n&&(0,c.jsx)(L.Provider,{value:{videoPermissionsGranted:o,storagePermissionsGranted:l},children:e.children})]})}var z=n(68276),G=n(67506),H=n(88620),J=n(30617);function K(e){let t=(0,h.useContext)(u.H),n=(0,h.useMemo)(()=>(0,c.jsx)(_.Z,{url:t.graphic.posterUrl}),[t.graphic.posterUrl]);return(0,c.jsx)(G.Z,{mode:"zg-server-time",loading:(0,c.jsx)(T.Z,{heading:(0,c.jsx)(R.Z,{session:t.session,layout:"heading",welcome:!0}),main:(0,c.jsx)(P.Z,{left:(0,c.jsx)(H.Z,{isError:!1,isBusy:!0,showProgress:!0,title:"Synchronising...",message:"Please wait while we synchronise clocks."}),right:n})}),error:(0,c.jsx)(H.Z,{isError:!0,isBusy:!1,showProgress:!1,title:"Synchronising...",message:"We were unable to synchronise clocks with the server."}),children:(0,c.jsx)(J.Z,{sid:e.sid,refresh:e.refresh,initialising:(0,c.jsx)(T.Z,{heading:(0,c.jsx)(R.Z,{session:t.session,layout:"heading",welcome:!0}),main:(0,c.jsx)(P.Z,{left:(0,c.jsx)(H.Z,{isError:!1,isBusy:!0,showProgress:!1,title:"Preparing...",message:"Please wait while we prepare to download the workshop content."}),right:n})}),loading:(0,c.jsx)(T.Z,{heading:(0,c.jsx)(R.Z,{session:t.session,layout:"heading",welcome:!0}),main:(0,c.jsx)(P.Z,{left:(0,c.jsx)(H.Z,{isError:!1,isBusy:!0,showProgress:!0,title:"Downloading content...",message:"Please wait while we download the workshop content."}),right:n})}),error:(0,c.jsx)(H.Z,{isError:!0,isBusy:!1,showProgress:!1,title:"Content error",message:"We were unable to retrieve content for this workshop."}),children:e.children})})}var Y=n(37471),Q=n(60182),X=n(74382),$=n(4766),ee=n(70883),et=n(93191);function en(e){let t=(0,h.useContext)(u.H),n=(0,h.useMemo)(()=>(0,c.jsx)(_.Z,{url:t.graphic.posterUrl}),[t.graphic.posterUrl]);return(0,c.jsx)(Y.C,{sid:e.sid,loading:(0,c.jsx)(T.Z,{heading:(0,c.jsx)(R.Z,{session:t.session,layout:"heading",welcome:!0}),main:(0,c.jsx)(P.Z,{left:(0,c.jsx)(H.Z,{isError:!1,isBusy:!0,showProgress:!1,title:"Connecting to live session...",message:"Please wait while we connect you to the workshop."}),right:n})}),error:(0,c.jsx)(H.Z,{isError:!0,isBusy:!1,showProgress:!1,title:"Connecting to live session...",message:"We were unable to connect you to the live session."}),children:(0,c.jsx)(Q.Z,{children:(0,c.jsx)(X.ZP,{children:(0,c.jsx)($.Z,{children:(0,c.jsx)(et.Z,{keepAwake:!0,refresh:e.refresh,children:(0,c.jsx)(ee.Z,{sid:e.sid,children:e.children})})})})})})}function ei(e){return(0,c.jsx)(V.ZP,{role:e.role,sid:e.sid,joinCode:e.joinCode,loading:(0,c.jsx)(H.Z,{isError:!1,isBusy:!0,showProgress:!1,title:"Checking permissions...",message:"Please wait while we confirm your access to the workshop."}),error:(0,c.jsx)(H.Z,{isError:!0,isBusy:!1,showProgress:!1,title:"Checking permissions...",message:"We were unable to confirm access to this workshop."}),children:(0,c.jsx)(u.Z,{sid:e.sid,initialising:(0,c.jsx)(H.Z,{isError:!1,isBusy:!0,showProgress:!1,title:"Preparing...",message:"Please wait while we prepare to retrieve the workshop."}),loading:(0,c.jsx)(H.Z,{isError:!1,isBusy:!0,showProgress:!1,title:"Retrieving workshop data...",message:"Please wait while we retrieve information about the workshop."}),error:(0,c.jsx)(H.Z,{isError:!0,isBusy:!1,showProgress:!1,title:"Content error",message:"We were unable to retrieve this workshop."}),children:e.children})})}var er=n(79044);function es(e){let{keepAwake:t}=e,[n,i]=(0,h.useState)(),[r,s]=(0,h.useState)();return(0,h.useEffect)(()=>{if(void 0===n&&void 0!==window.navigator){var e;i(null===(e=window.navigator)||void 0===e?void 0:e.wakeLock)}},[]),(0,h.useEffect)(()=>{console.debug("Wake lock: ".concat(void 0===n?"unavailable":"available",", keepAwake: ").concat(t));try{void 0===n||(t&&void 0===r&&n.request("screen").then(e=>{console.debug("Wake lock sentinel acquired"),s(e)}).catch(e=>{console.error("Wake lock exception",e)}),t||(void 0!==r&&console.debug("Releasing wake lock sentinel..."),null==r||r.release().then(()=>{console.debug("Wake lock sentinel released."),s(void 0)})))}catch(e){console.warn("Unable to request screen lock",e)}return()=>{void 0!==r&&console.debug("Relesaing wake lock sentinel..."),null==r||r.release().then(()=>{console.debug("Wake lock sentinel released."),s(void 0)})}},[n,t]),(0,c.jsx)(c.Fragment,{})}function eo(e){return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(g,{}),(0,c.jsx)(d.Z,{children:(0,c.jsxs)(ei,{sid:e.sid,role:e.role,joinCode:e.joinCode,children:[(0,c.jsx)(p,{}),(0,c.jsx)(O,{sid:e.sid,refresh:e.refresh,children:(0,c.jsx)(K,{sid:e.sid,refresh:e.refresh,children:(0,c.jsx)(er.Z,{children:(0,c.jsx)(en,{sid:e.sid,refresh:e.refresh,children:(0,c.jsxs)(z.Z,{children:[(0,c.jsx)(es,{keepAwake:!0}),e.children]})})})})})]})})]})}},15785:function(e,t,n){"use strict";var i,r;n.d(t,{I:function(){return s},S:function(){return i}}),(r=i||(i={}))[r.default=0]="default",r[r.deliberation=1]="deliberation";let s={activity:0,index:0,notes:"",qids:[],secs:void 0}},28801:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var i=n(57437),r=n(2265),s=n(94547),o=n(70883),a=n(27270),l=n(37471);let c=[s.um.Error,s.um.Disconnected,s.um.Disconnecting,s.um.Offline],d=[s.um.Online,s.um.Connecting,s.um.Connected,s.um.Joining];function u(){let e=(0,r.useContext)(o.l),t=(0,r.useContext)(l.Z),[n,u]=(0,r.useState)(e.thisUser),[h,p]=(0,r.useState)(t.state),[g,f]=(0,r.useState)(c.includes(h)),[x,m]=(0,r.useState)(d.includes(h)),[y,v]=(0,r.useState)("TODO"),[b,w]=(0,r.useState)(0);return(0,r.useEffect)(()=>{u(e.thisUser)},[e]),(0,r.useEffect)(()=>{console.debug("Connection warning, state: ".concat(s.um[t.state])),p(t.state)},[t.state,n]),(0,r.useEffect)(()=>{let e=c.includes(h),t=d.includes(h);e&&v("Disconnected from the workshop server."),t&&v("Please wait, connecting to the workshop server..."),f(e),m(t)},[h]),(0,r.useEffect)(()=>{w(g||x?1:0)},[g,x]),(0,i.jsx)(a.Z,{variant:"filled",severity:g?"warning":"info",sx:{opacity:b},children:y})}},97340:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var i=n(57437),r=n(31193),s=n(80511);function o(e){return(0,i.jsxs)(r.Z,{sx:{maxHeight:"100%",maxWidth:"100%",display:"flex",flexDirection:"column",background:"white",borderRadius:2,p:2,...e.sx},children:[(e.title||e.tools)&&(0,i.jsxs)(r.Z,{display:"flex",flexDirection:"row",justifyContent:"space-between",sx:{mb:1},children:[e.title&&(0,i.jsx)(s.Z,{variant:"h6",children:e.title}),e.tools]}),(0,i.jsx)(r.Z,{sx:{height:"100%",maxHeight:"100%",display:"block",overflowY:"hidden"},children:(0,i.jsx)(r.Z,{sx:{width:"100%",maxWwidth:"100%",height:"100%",maxHeight:"100%",overflowY:e.scrolling?"auto":"hidden"},children:e.children})})]})}},42410:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var i=n(57437),r=n(76548),s=n(31193),o=n(80511),a=n(99128);function l(e){let t=()=>{var t,n;return(0,i.jsx)(r.Z,{variant:null!==(t=e.variant)&&void 0!==t?t:"contained",type:"submit",size:!0===e.large?"large":"medium",color:"buttonStandard",onClick:e.onSubmit,disabled:!e.enabled||e.busy,children:(0,i.jsxs)(s.Z,{sx:{px:1,display:"flex",flexDirection:"column"},children:[(0,i.jsx)(o.Z,{variant:"submitButton",children:null!==(n=e.text)&&void 0!==n?n:"Submit"}),e.busy&&(0,i.jsx)(a.Z,{})]})})},n="left"===e.alignment?"flex-start":"right"===e.alignment?"flex-end":"stretch";return(0,i.jsxs)(i.Fragment,{children:[e.inline&&(0,i.jsx)(t,{}),!e.inline&&(0,i.jsx)(s.Z,{sx:e.sx,display:"flex",flexDirection:"row",justifyContent:n,children:(0,i.jsx)(t,{})})]})}},71359:function(e,t,n){"use strict";n.d(t,{Q:function(){return r},Z:function(){return x}});var i,r,s=n(57437),o=n(2265),a=n(31193),l=n(42410),c=n(22599),d=n.n(c),u=n(48620),h=n(94547),p=n(74382),g=n(26049),f=n(45231);function x(e){var t;let n=(0,o.useContext)(p.v1),i=()=>{var t;return(0,p.Zp)(n.allAnswers[e.qids.qid],e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)},[c,x]=(0,o.useState)(i()),[m,y]=(0,o.useState)(i()),[v,b]=(0,o.useState)(!1),[w,j]=(0,o.useState)(e.role===h._b.Client),k=t=>{var n,i;return{answers:[{key:"".concat(t),index:t,description:null!==(i=null===(n=e.marks)||void 0===n?void 0:n[t])&&void 0!==i?i:"".concat(t),numericValue:1}]}};(0,o.useEffect)(()=>{var e;y({...c,jsonValue:null!==(e=c.jsonValue)&&void 0!==e?e:k(0)})},[c]);let S=async()=>{e.role===h._b.Client?(b(!0),e.onAnswer(m).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),e)x(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{b(!1)})):console.warn("Only participants can submit answers")},Z=()=>{var t,n;switch(e.type){case 2:return 1;case 0:return null!==(t=e.numericStep)&&void 0!==t?t:.01;case 1:return null!==(n=e.numericStep)&&void 0!==n?n:1;default:throw"Unsupported SliderInputType ".concat(r[e.type])}},C=e.marks?100-100/e.marks.length:void 0,D=C?"".concat(C,"%"):void 0;return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(a.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[e.question&&(0,s.jsx)(u.Z,{content:e.question}),(0,s.jsx)(a.Z,{sx:{display:"flex",flexDirection:"column",flexGrow:1,alignItems:"center",justifyContent:"center",px:4},children:(0,s.jsx)(a.Z,{sx:{width:null!=D?D:"90%"},children:(0,s.jsx)(g.Z,{onCommit:e=>{y({...m,jsonValue:k(e)})},color:"secondary",sliderDefault:m.jsonValue?d().toNumber(Object.entries(m.jsonValue)[0][0]):0,marks:null!==(t=(()=>{switch(e.type){case 2:return e.marks.map((e,t)=>({value:t,label:e}));case 0:return;case 1:return d().range(e.numericRange[0],e.numericRange[1]+1,Z()).map((e,t)=>({value:e,label:"".concat(e)}))}})())&&void 0!==t&&t,slots:{markLabel:f.A},min:(()=>{switch(e.type){case 2:return 0;case 0:case 1:return e.numericRange?e.numericRange[0]:0;default:throw"Unsupported SliderInputType ".concat(r[e.type])}})(),max:(()=>{switch(e.type){case 2:return e.marks.length-1;case 0:case 1:return e.numericRange?e.numericRange[1]:10;default:throw"Unsupported SliderInputType ".concat(r[e.type])}})(),step:Z(),sliderMode:"solo"})})}),e.role===h._b.Client&&(0,s.jsx)(a.Z,{sx:{mt:8,mr:8},children:(0,s.jsx)(l.Z,{onSubmit:S,text:"Submit",busy:v,enabled:w,inline:!1,alignment:"right"})})]})})}(i=r||(r={}))[i.continuous=0]="continuous",i[i.discrete=1]="discrete",i[i.categorical=2]="categorical"},26049:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=n(57437),r=n(48024),s=n(43298),o=n(2265);function a(e){var t;let[n,a]=(0,o.useState)(null!==(t=e.sliderDefault)&&void 0!==t?t:0),[l,c]=(0,o.useState)("solo"===e.sliderMode?1:.5),d=(0,o.useMemo)(()=>(0,r.ZP)(s.ZP)({color:"secondary",height:"".concat(.8*l,"em"),"& .MuiSlider-thumb":{height:"".concat(1.6*l,"em"),width:"".concat(1.6*l,"em"),backgroundColor:"secondary",boxShadow:"0px 4px 10px 0px rgba(0, 0, 0, 0.25) inset","&::before":{display:"none"}},"& .MuiSlider-rail":{borderRadius:"".concat(.4*l,"em"),boxShadow:"0px 4px 10px 0px rgba(0, 0, 0, 0.25) inset"},"& .MuiSlider-track":{borderRadius:"".concat(.4*l,"em"),boxShadow:"0px 4px 10px 0px rgba(0, 0, 0, 0.25) inset"},"& .MuiSlider-markLabel":{fontSize:"".concat(.6*l,"em"),marginTop:"".concat(1.6*l,"em")}}),[l]);return(0,i.jsx)(d,{...e,value:n,onChange:(e,t)=>{a(t)},onChangeCommitted:(t,n)=>{let i=n;e.acceptableRange&&i>e.acceptableRange.max&&(i=e.acceptableRange.max),e.acceptableRange&&i<e.acceptableRange.min&&(i=e.acceptableRange.min),a(i),e.onCommit(i)}})}},45231:function(e,t,n){"use strict";n.d(t,{A:function(){return o}});var i=n(57437),r=n(43298),s=n(80511);let o=e=>{let t=e["data-index"],n=e.ownerState.marks[t],o=e.ownerState.marks.length,a={...e.style,width:"".concat(100/o,"%"),wordWrap:"normal",whiteSpace:"wrap"};return(0,i.jsx)(r.J$,{...e,style:a,children:(0,i.jsx)(s.Z,{variant:"sliderMark",style:{display:"block",wordWrap:"normal",whiteSpace:"wrap"},children:n.label})})}},45080:function(e,t,n){"use strict";n.d(t,{L:function(){return r},Z:function(){return P}});var i,r,s=n(57437),o=n(2265),a=n(48620),l=n(22960),c=n(31193),d=n(66858),u=n(44908),h=n(65786),p=n(76548),g=n(69065),f=n(66124),x=n(60335),m=n(80511),y=n(42410),v=n(94547),b=n(74382),w=n(73391),j=n(60320);let k=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,S=(e,t,n)=>{let i=[],s=null!=t?t:"";switch(e){case r.text:let o=n?s.length>0?null:"Please enter an answer":null;null!==o&&i.push(o);break;case r.email:let a=k.test(s.trim()),l=n?s.trim().length>0&&a?null:"Please enter a valid email address":0===s.trim().length||a?null:"Please enter a valid email address";null!==l&&i.push(l);break;default:throw"Unsupported TextInputType"}return i},Z=(e,t)=>{if(console.debug("Validating checkboxes",e),void 0===e)return["Checkbox data undefined."];let n=e.filter(e=>e.checked).length,i=e.map((e,t)=>e.required&&!e.checked?"The ".concat((0,w.q)(t+1)," checkbox is required."):null).filter(e=>null!==e).map(e=>e),r=[];return n<t&&r.push("Please select at least ".concat(t," ").concat(1===t?"checkbox":"checkboxes",".")),[...i,...r]},C=()=>(0,s.jsx)(j.Z,{children:(0,s.jsx)("svg",{focusable:"false","aria-hidden":"true","data-testid":"CheckBoxBlankIcon",children:(0,s.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5",fill:"white"})})});var D=n(49428),I=n(7630),E=n(19309);(i=r||(r={}))[i.text=0]="text",i[i.email=1]="email";let A=(e,t)=>({...e,jsonValue:{answers:[{key:"text",stringValue:t.answer},...t.checks.map(e=>({key:e.key,stringValue:e.text,booleanValue:e.checked}))]}}),q=(e,t)=>{var n,i;return{answer:null===(i=e.jsonValue)||void 0===i?void 0:null===(n=i.answers.find(e=>"text"===e.key))||void 0===n?void 0:n.stringValue,checks:t.map(t=>{var n,i,r;return{key:t.key,text:t.text,initial:t.initial,checked:null!==(r=null===(i=e.jsonValue)||void 0===i?void 0:null===(n=i.answers.find(e=>e.key===t.key))||void 0===n?void 0:n.booleanValue)&&void 0!==r?r:t.initial,required:t.required}})}};function P(e){let t=(0,o.useContext)(b.v1),[n,i]=(0,o.useState)((0,b.Zp)(t.allAnswers[e.qids.qid],e.qids,e.question.pii)),[r,w]=(0,o.useState)({answer:void 0,checks:[]}),[j,k]=(0,o.useState)(!1),[P,_]=(0,o.useState)(!0),[T,R]=(0,o.useState)(e.role===v._b.Client),[F,N]=(0,o.useState)(!1),[U,B]=(0,o.useState)(!1),[W,V]=(0,o.useState)([]),[M,L]=(0,o.useState)(),[O,z]=(0,o.useState)(!1),G=()=>{z(!1)};(0,o.useEffect)(()=>{w(q(n,e.checkboxes))},[n]);let H=()=>{var t,n;let i=[...Z(r.checks,e.minCheckboxes),...S(e.type,r.answer,e.textRequired)],s=(null!==(n=null===(t=r.answer)||void 0===t?void 0:t.length)&&void 0!==n?n:0)>0;return _(!U||0===i.length&&(s||!e.textRequired)),V(i),0===i.length};(0,o.useEffect)(()=>{U&&H()},[r]);let J=async()=>{if(e.role===v._b.Client&&P){if(B(!0),H()){let t=A(n,r);console.debug("Submitting TextInput",t),k(!0),e.onAnswer(t).then(t=>{if(console.debug("Answer submitted ".concat(t?"ok":"error")),console.debug("Received answer response",t),null!==t)w(q(t,e.checkboxes));else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{k(!1)})}}else console.warn("Only participants can submit answers")},K=async()=>{let t=A(n,{...r,answer:void 0,checks:[]});k(!0),e.onAnswer(t).then(t=>{if(console.debug("Answer submitted ".concat(t?"ok":"error")),console.debug("Received answer response",t),null!==t)w(q(t,e.checkboxes));else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{k(!1)})},Y=(e,t)=>{let n={...r,checks:[...r.checks]};n.checks.find(t=>t.key===e).checked=t,w(n)};return(0,o.useEffect)(()=>{L(W.join("<br/>")),N(W.length>0)},[W]),(0,l.Z)(),(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(c.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[e.question&&(0,s.jsx)(a.Z,{content:e.question}),(0,s.jsx)(d.Z,{label:e.label,variant:"outlined",defaultValue:r.answer,helperText:M,onChange:e=>{w({...r,answer:e.target.value})},error:F,color:"buttonStandard",sx:{input:{background:"white"}}}),r.checks.map((t,n)=>(0,s.jsx)(c.Z,{display:"flex",flexDirection:"row",children:(0,s.jsx)(u.Z,{control:(0,s.jsx)(h.Z,{checked:t.checked,onChange:(e,n)=>Y(t.key,n),icon:e.forceCheckboxesWhite?(0,s.jsx)(C,{}):void 0}),label:t.text})},"checkbox-".concat(e.qids.qid,"-").concat(n,"-").concat(t.key))),e.information&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.Z,{variant:"text",fullWidth:!1,color:"buttonStandard",sx:{textDecoration:"underline",alignSelf:"start"},startIcon:(0,s.jsx)(D.Z,{}),onClick:()=>z(!0),children:e.information.heading}),(0,s.jsx)(g.Z,{fullWidth:!0,maxWidth:"md",open:O,onClose:G,children:(0,s.jsxs)(f.Z,{children:[(0,s.jsx)(c.Z,{style:{position:"absolute",top:0,right:0},children:(0,s.jsx)(x.Z,{"aria-label":"close",onClick:G,children:(0,s.jsx)(I.Z,{})})}),(0,s.jsx)(c.Z,{sx:{p:2},display:"flex",flexDirection:"column",children:e.information.body.map((t,n)=>(0,s.jsx)(m.Z,{variant:"slideInfoText",align:"left",dangerouslySetInnerHTML:{__html:(0,E.Z)(t)}},"".concat(e.qids.qid,"-info-body-").concat(n)))})]})})]}),(0,s.jsxs)(c.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"row",gap:1,justifyContent:"end",alignItems:"end"},children:[e.skipText&&(0,s.jsx)(y.Z,{inline:!0,busy:j,onSubmit:K,large:!0,variant:"outlined",text:e.skipText,enabled:!0}),(0,s.jsx)(y.Z,{inline:!0,busy:j,onSubmit:J,large:!0,text:e.submitText,enabled:!U||P})]})]})})}},48620:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var i=n(57437),r=n(31193),s=n(80511);function o(e){let{content:t}=e;return(0,i.jsx)(i.Fragment,{children:((null==t?void 0:t.explanation)||(null==t?void 0:t.instruction)||(null==t?void 0:t.question))&&(0,i.jsxs)(r.Z,{sx:{mb:2,display:"flex",flexDirection:"column"},children:[t.instruction&&(0,i.jsx)(s.Z,{variant:"questionInstruction",align:"left",children:t.instruction}),t.question&&(0,i.jsx)(s.Z,{variant:"questionPrompt",align:"left",children:t.question}),t.explanation&&(0,i.jsx)(s.Z,{variant:"questionExplanation",align:"left",children:t.explanation})]})})}},2962:function(e,t,n){"use strict";n.d(t,{J:function(){return r},Z:function(){return v}});var i,r,s=n(57437),o=n(2265),a=n(74382),l=n(22960),c=n(24132),d=n(48620),u=n(41506),h=n(28651),p=n(43152),g=n(22599),f=n.n(g),x=n(75511),m=n(35231),y=n(97294);function v(e){let t=(0,o.useContext)(a.v1),[n,i]=(0,o.useState)([]),[r,v]=(0,o.useState)();(0,o.useEffect)(()=>{var n;i(null!==(n=t.allAnswers[e.qids.qid])&&void 0!==n?n:[])},[t]),(0,o.useEffect)(()=>{switch(e.inputType){case c.rT.categorical:v((0,c.dx)(n,e.categories,e.range));break;case c.rT.numerical:v((0,c.B8)((0,c.tJ)(n,e.range)));break;default:throw"Unsupported GraphInputType"}setTimeout(()=>{x.Z.emit({type:x.z.Request_SlideRefresh})},1e3)},[n]);let b={scaleType:"linear",tickInterval:f().range(0,1e3,1),tickLabelInterval:e=>(0,g.isInteger)(e),valueFormatter:e=>"".concat(e.toFixed(0)),disableLine:!0,disableTicks:!1},w={scaleType:"band",dataKey:"category",disableLine:!1,disableTicks:!1},j=(0,l.Z)();return(0,s.jsxs)(s.Fragment,{children:[e.question&&(0,s.jsx)(d.Z,{content:e.question}),(0,s.jsx)(m.h,{width:"100%",height:"100%",minWidth:50,minHeight:50,children:(0,s.jsx)(u.v,{layout:1===e.orientation?"vertical":"horizontal",margin:{left:150},grid:{horizontal:1===e.orientation,vertical:0===e.orientation},dataset:r,barLabel:"value",sx:{[".".concat(h.Is.root)]:{},".MuiBarElement-series-votes_id":{fill:j.palette.secondary.main},".MuiBarLabel-series-votes_id":{fill:"white",fontWeight:"bolder"},["& .".concat(p.k.line)]:{strokeDasharray:"5 3",strokeWidth:1},[".".concat(y.x.tickContainer)]:{textWrap:"wrap"},[".".concat(y.x.tickLabel)]:{fontSize:"1rem !important"}},slotProps:{bar:{rx:4,ry:4}},xAxis:[1===e.orientation?w:b],yAxis:[1===e.orientation?b:w],series:[{dataKey:"votes",label:void 0,id:"votes_id",valueFormatter:e=>null===e?"No data":1===e?"1 vote":"".concat(e.toFixed(0)," votes")}]})})]})}(i=r||(r={}))[i.horizontal=0]="horizontal",i[i.vertical=1]="vertical"},24132:function(e,t,n){"use strict";n.d(t,{B8:function(){return x},dx:function(){return u},rT:function(){return o},tJ:function(){return h}});var i,r,s,o,a=n(22599),l=n.n(a);(i=s||(s={}))[i.bar=0]="bar",(r=o||(o={}))[r.categorical=0]="categorical",r[r.numerical=1]="numerical";let c=e=>{var t,n;return l().range(e.lo,e.hi+(null!==(t=e.step)&&void 0!==t?t:1),null!==(n=e.step)&&void 0!==n?n:1)},d=e=>e.replace(/\\n/g,"\n"),u=(e,t,n)=>p(e,t,n).map((t,n)=>({category:d(t),votes:g(e,n)})),h=(e,t)=>c(t).map(t=>({value:t,votes:f(e,t)})),p=(e,t,n)=>{let i=void 0!==t?t:void 0!==n?c(n).map(e=>"".concat(e)):void 0;if(void 0===i)throw"Cannot determine categories";return i.filter(e=>void 0!==e).map(e=>e)},g=(e,t)=>l().sum(e.map(e=>{var n;return l().sum(null===(n=e.jsonValue)||void 0===n?void 0:n.answers.filter(e=>e.index===t).map(e=>{var t;return null!==(t=e.numericValue)&&void 0!==t?t:0}))})),f=(e,t)=>g(e,t),x=e=>e.map(e=>({category:"".concat(e.value),votes:e.votes}))},73391:function(e,t,n){"use strict";n.d(t,{q:function(){return i}});let i=e=>{let t=e%10,n=e%100;return 1===t&&11!==n?e+"st":2===t&&12!==n?e+"nd":3===t&&13!==n?e+"rd":e+"th"}},84075:function(){}}]);
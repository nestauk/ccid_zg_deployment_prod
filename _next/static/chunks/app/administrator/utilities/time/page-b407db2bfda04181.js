(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[762],{76606:function(e,t,r){Promise.resolve().then(r.bind(r,743))},743:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var n=r(57437),s=r(58253),o=r(67506),i=r(48801),a=r(2265);function c(){return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(i.Z,{children:(0,n.jsx)(s.Z,{children:(0,n.jsx)(o.Z,{mode:"zg-server-time",loading:(0,n.jsx)("p",{children:"Synchronising..."}),error:(0,n.jsx)("p",{children:"Synchronisation error"}),children:(0,n.jsx)(()=>{var e=(0,a.useContext)(o.G);let[t,r]=(0,a.useState)(0);return(0,a.useEffect)(()=>{let t=()=>{r(e.toServerTime(Date.now()))},n=setInterval(()=>t(),0);return()=>{clearInterval(n)}},[e]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h1",{children:new Date(t).toISOString()}),(0,n.jsxs)("p",{children:["offset: ",e.offset]}),(0,n.jsxs)("p",{children:["rtt: ",e.rtt]}),(0,n.jsxs)("p",{children:["source: ",(0,n.jsx)("code",{children:JSON.stringify(e.source)})]}),(0,n.jsx)("p",{children:(0,n.jsx)("span",{style:{fontSize:256},children:new Date(t).getSeconds()})})]})},{})})})})})}},67506:function(e,t,r){"use strict";r.d(t,{G:function(){return u},Z:function(){return d}});var n,s,o=r(57437),i=r(2265),a=r(80237),c=r(75511),l=r(58253);let u=(0,i.createContext)({});function d(e){var t;let r=(0,i.useContext)(l.A),[n,d]=(0,i.useState)(0),[m,f]=(0,i.useState)(),[h,v]=(0,i.useState)(null!==(t=e.checks)&&void 0!==t?t:3);(0,i.useEffect)(()=>{switch(console.debug("ZgServerTimeProvider state",s[n]),n){case 0:c.Z.emit({type:c.z.Content_Progress_Update,data:{overall:{completed:0,total:h},bars:{}}}),d(1);break;case 1:g().then(e=>{f(e),d(3)}).catch(e=>{console.error(e),d(2)})}},[n]);let g=async()=>{switch(e.mode){case"server-date-lib":return S();case"zg-server-time":return p();default:throw Error("Unsupported time sync mode")}},p=async()=>{let e;console.debug("zg-server-time warmup",await r.getServerTime());let t=Number.MAX_SAFE_INTEGER,n=0;for(let s=0;s<h;s++){let o=Date.now(),i=await r.getServerTime(),a=Date.now();console.debug("zg-server-time response",i);let l=a-o,u=(o+a)/2,d=i.timestamp-u;l<t&&(t=l,n=d,e=i),c.Z.emit({type:c.z.Content_Progress_Update,data:{overall:{completed:s+1,total:h},bars:{}}}),await new Promise(e=>setTimeout(e,1e3))}let s={offset:n,rtt:t,source:e,toServerTime:e=>e+n,fromServerTime:e=>e-n};return console.debug("zg-server-time result",s),s},S=async()=>{let e;console.warn("ServerDateLib is only accurate to the second.");for(let t=0;t<h;t++){await new Promise(e=>setTimeout(e,1e3));let r=await (0,a.a)();(void 0===e||Math.abs(r.uncertainty)<Math.abs(e.uncertainty))&&(e=r),c.Z.emit({type:c.z.Content_Progress_Update,data:{overall:{completed:t+1,total:h},bars:{}}})}let t={offset:e.offset,source:e,rtt:e.uncertainty,toServerTime:t=>t+e.offset,fromServerTime:t=>t-e.offset};return console.debug("server-date result",e),t};return(0,o.jsxs)(o.Fragment,{children:[(0===n||1===n)&&e.loading,2===n&&e.error,3===n&&(0,o.jsx)(u.Provider,{value:m,children:e.children})]})}(n=s||(s={}))[n.Init=0]="Init",n[n.Synchronising=1]="Synchronising",n[n.Error=2]="Error",n[n.Complete=3]="Complete"}},function(e){e.O(0,[732,887,501,247,971,23,744],function(){return e(e.s=76606)}),_N_E=e.O()}]);